<!doctype html>
<html lang="en-us" class=scroll-smooth data-default-appearance=light data-auto-appearance=true>
  <head>
    
    <!-- Clicky -->
    <script>var clicky_site_ids = clicky_site_ids || []; clicky_site_ids.push(101320555);</script>
    <script async src="//static.getclicky.com/js"></script>
    <!-- Clicky -->
    <meta charset="utf-8">
    <title>Luca's blog - Home</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Luca Cambiaghi" />
    <meta name="description" content="Luca&#39;s blog" />
    <meta name="keywords" content="" />
    <link rel="stylesheet" href="https://lucacambiaghi.com/static/style.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">
    <script async src="https://talk.hyvor.com/embed/embed.js" type="module"></script>
    <script type=text/javascript src="https://lucacambiaghi.com/static//js/appearance.js"></script>
    <script defer type=text/javascript id=script-bundle src="https://lucacambiaghi.com/static//js/main.js" data-copy=Copy data-copied=Copied></script>
    
  </head>

  <body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 bg-neutral text-neutral-900 sm:px-14 md:px-24 lg:px-32 dark:bg-neutral-800 dark:text-neutral max-w-7xl">
    
    <div id=the-top class="absolute flex self-center">
  <a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 dark:bg-neutral-600 focus:translate-y-0" href=#main-content>
    <span class="font-bold ltr:pr-2 rtl:pl-2 text-primary-600 dark:text-primary-400">&darr;
    </span>Skip to main content
  </a>
</div>

<header class="flex justify-between py-6 font-semibold sm:items-center sm:py-10 text-neutral-900 dark:text-neutral print:hidden">
  <div><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href="/index.html">Luca</a></div>
<nav>
  <ul class="flex list-none sm:flex-row">
    <li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
      <a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href="/posts.html">posts</a>
    </li>
    <span class="px-2 text-primary-500">&#183;</span>
    <li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
      <a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href="/emacsd.html">emacs</a>
    </li>
    <span class="px-2 text-primary-500">&#183;</span>
    <li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
      <a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href="/nix.html">nix</a>
    </li>
  </ul>
</nav>
</header>

    

    <main id="main" class="relative grow">
      
<article class="page">
  <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
    Luca&#39;s emacs configuration
  </h1>
  <section class="prose dark:prose-invert">
    
<div id="outline-container-about-this-config" class="outline-2">
<h2 id="about-this-config">About this config</h2>
<div class="outline-text-2" id="text-about-this-config">
</div>
<div id="outline-container-history" class="outline-3">
<h3 id="history">History</h3>
<div class="outline-text-3">
<p>
After using <a href="https://github.com/doomemacs/doomemacs">doom-emacs</a> for the whole of 2020, in early 2021 I wrote
<a href="https://github.com/lccambiaghi/vanilla-emacs">my own config from scratch</a>. Over 2 years I accumulated snippets and
packages until it became slow and complex. In 2023 I decided to
simplify my configuration files.
</p>

<p>
Approach:
</p>
<ul class="org-ul">
<li>Use <a href="https://github.com/SystemCrafters/crafted-emacs">crafted-emacs</a> as a solid foundation
<ul class="org-ul">
<li>Great <code>init.el</code> and <code>early-init.el</code></li>
<li>Solid defaults for built-in packages e.g. <code>org-mode</code></li>
<li>Great configuration of essential external packages e.g. <code>corfu</code>, <code>vertico</code>, &#x2026;</li>
</ul></li>
<li>Cherry-pick the essential parts of my "big" vanilla config</li>
<li>Use more of the built-in packages, <code>emacs29</code> comes with a lot of cool
stuff (<code>use-package</code>, <code>tree-sitter</code>, <code>modus-themes</code>), plus I can try
leverage more of the features introduced with emacs 27 and 28
(<code>project</code>, <code>tab-bar</code>, <code>flymake</code>). I tried to set up <code>eglot</code> but
I really need <code>dap-mode</code>.</li>
</ul>
</div>
</div>

<div id="outline-container-structure" class="outline-3">
<h3 id="structure">Structure</h3>
<div class="outline-text-3">
<p>
Sections:
</p>
<ul class="org-ul">
<li>Emacs core settings
<ul class="org-ul">
<li>Configuration with <code>(use-package emacs)</code> blocks (no external packages), variables, helpers</li>
<li>Install <code>no-littering</code></li>
<li>Load modules provided by <code>crafted-emacs</code></li>
<li>Install <code>vc-use-package</code> to add the <code>:vc</code> keyword to <code>use-package</code></li>
</ul></li>
<li>User interface
<ul class="org-ul">
<li>Configuration with <code>(use-package emacs)</code> blocks</li>
<li>Then external packages</li>
</ul></li>
<li>Packages
<ul class="org-ul">
<li>External packages</li>
<li>Evil</li>
<li>Git</li>
<li>Org mode</li>
<li>Programming languages</li>
</ul></li>
<li>Keybindings</li>
</ul>

<p>
In my previous "big" config I had organized everything into modules
but I found that I need all the packages I use and I don't need the
packages I don't use. This means I always need all modules, which
means I don't need any modules.
</p>

<p>
The only exception could the <a href="#org1e1f868">Programming languages</a> section,
where maybe I will only rarely need to use the <code>R</code> packages or the
<code>clojure</code> packages. If you think about it, since all packages are
deferred, they will only be loaded when needed. This means that the
only cost of keeping those sections in my config is the time spent
installing the packages on the first setup.
</p>
</div>
</div>
</div>

<div id="outline-container-emacs-core-settings" class="outline-2">
<h2 id="emacs-core-settings">Emacs core settings</h2>
<div class="outline-text-2" id="text-emacs-core-settings">
</div>
<div id="outline-container-use-package" class="outline-3">
<h3 id="use-package">use-package</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">emacs</span>
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> use-package-always-ensure t)
  (<span class="org-keyword">setq</span> use-package-always-defer t)
  (<span class="org-keyword">setq</span> use-package-compute-statistics t)
  (<span class="org-keyword">setq</span> use-package-expand-minimally t))
</pre>
</div>
</div>
</div>

<div id="outline-container-user-variables" class="outline-3">
<h3 id="user-variables">User variables</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">emacs</span>
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">defvar</span> <span class="org-variable-name">user-config-directory</span> crafted-config-path)
  (<span class="org-keyword">defvar</span> <span class="org-variable-name">lc/use-xwidget-browser</span> t)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">fix void-variable in some packages e.g. helpful</span>
  (<span class="org-keyword">defvar</span> <span class="org-variable-name">read-symbol-positions-list</span> nil))
</pre>
</div>
</div>
</div>

<div id="outline-container-helper-for-tangling" class="outline-3">
<h3 id="helper-for-tangling">Helper for tangling</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">emacs</span>
  <span class="org-builtin">:hook</span>
  (org-mode . (<span class="org-keyword">lambda</span> ()
                (add-hook 'after-save-hook #'org-babel-tangle-config)))
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">org-babel-tangle-config</span> ()
    (<span class="org-keyword">when</span> (string-equal (buffer-file-name)
                        (expand-file-name <span class="org-string">"readme.org"</span> crafted-config-path))
      <span class="org-comment-delimiter">;; </span><span class="org-comment">Dynamic scoping to the rescue</span>
      (<span class="org-keyword">let</span> ((org-confirm-babel-evaluate nil))
        (org-babel-tangle)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-fix-helpful" class="outline-3">
<h3 id="fix-helpful">Fix helpful</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">helpful</span>
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">helpful--autoloaded-p</span> (sym buf)
    <span class="org-doc">"Return non-nil if function SYM is autoloaded."</span>
    (<span class="org-keyword">-when-let</span> (file-name (buffer-file-name buf))
      (<span class="org-keyword">setq</span> file-name (s-chop-suffix <span class="org-string">".gz"</span> file-name))
      (<span class="org-keyword">condition-case</span> nil
          (help-fns--autoloaded-p sym file-name)
                                        <span class="org-comment-delimiter">; </span><span class="org-comment">new in Emacs 29.0.50</span>
                                        <span class="org-comment-delimiter">; </span><span class="org-comment">see https://github.com/Wilfred/helpful/pull/283</span>
        (<span class="org-warning">error</span> (help-fns--autoloaded-p sym))))))
</pre>
</div>
</div>
</div>

<div id="outline-container-disable-electric-indent-mode" class="outline-3">
<h3 id="disable-electric-indent-mode">Disable electric-indent-mode</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">emacs</span>
  <span class="org-builtin">:init</span>
  (electric-indent-mode -1))
</pre>
</div>
</div>
</div>

<div id="outline-container-enlarge-window" class="outline-3">
<h3 id="enlarge-window">Enlarge window</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">emacs</span>
  <span class="org-builtin">:bind</span>
  (<span class="org-string">"&lt;leader&gt;wo"</span> . 'doom/window-enlargen)
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">doom/window-enlargen</span> (<span class="org-type">&amp;optional</span> arg)
    <span class="org-doc">"Enlargen the current window to focus on this one. Does not close other</span>
<span class="org-doc">windows (unlike `</span><span class="org-doc"><span class="org-constant">doom/window-maximize-buffer</span></span><span class="org-doc">'). Activate again to undo."</span>
    (<span class="org-keyword">interactive</span> <span class="org-string">"P"</span>)
    (<span class="org-keyword">let</span> ((param 'doom--enlargen-last-wconf))
      (<span class="org-keyword">cl-destructuring-bind</span> (window . wconf)
          (<span class="org-keyword">or</span> (frame-parameter nil param)
              (cons nil nil))
        (set-frame-parameter
         nil param
         (<span class="org-keyword">if</span> (<span class="org-keyword">and</span> (equal window (selected-window))
                  (not arg)
                  wconf)
             (ignore
              (<span class="org-keyword">let</span> ((source-window (selected-window)))
                (set-window-configuration wconf)
                (<span class="org-keyword">when</span> (window-live-p source-window)
                  (select-window source-window))))
           (<span class="org-keyword">prog1</span> (cons (selected-window) (<span class="org-keyword">or</span> wconf (current-window-configuration)))
             (<span class="org-keyword">let*</span> ((window (selected-window))
                    (dedicated-p (window-dedicated-p window))
                    (preserved-p (window-parameter window 'window-preserved-size))
                    (ignore-window-parameters t)
                    (window-resize-pixelwise nil)
                    (frame-resize-pixelwise nil))
               (<span class="org-keyword">unwind-protect</span>
                   (<span class="org-keyword">progn</span>
                     (<span class="org-keyword">when</span> dedicated-p
                       (set-window-dedicated-p window nil))
                     (<span class="org-keyword">when</span> preserved-p
                       (set-window-parameter window 'window-preserved-size nil))
                     (maximize-window window))
                 (set-window-dedicated-p window dedicated-p)
                 (<span class="org-keyword">when</span> preserved-p
                   (set-window-parameter window 'window-preserved-size preserved-p))
                 (add-hook 'doom-switch-window-hook #'doom--enlargened-forget-last-wconf-h)))))))))
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-web-browser-in-emacs" class="outline-3">
<h3 id="web-browser-in-emacs">Web browser in emacs</h3>
<div class="outline-text-3">
<p>
Note:
</p>
<ul class="org-ul">
<li>Sometimes after browsing the web and returning to a buffer
(e.g. this config) some bindings get erased (e.g. <code>ESC</code> does not
return to normal mode)</li>
<li>Apparently this behavior is only buffer local so to fix it one can
just kill the tabspace, reopen the buffer and they get restored</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">emacs</span>
  <span class="org-builtin">:bind</span>
  (<span class="org-string">"&lt;leader&gt;sw"</span> . (<span class="org-keyword">lambda</span> () (<span class="org-keyword">interactive</span>)
                    (tabspaces-switch-or-create-workspace <span class="org-string">"web"</span>)
                    (lc/open-url <span class="org-string">"google.com"</span>)))
  (<span class="org-string">"&lt;leader&gt;su"</span> . (<span class="org-keyword">lambda</span> () (<span class="org-keyword">interactive</span>) (call-interactively 'lc/open-url)))
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> lc/xwidget-webkit-last-session-buffer nil)
  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/open-url-other-window</span> (url <span class="org-type">&amp;optional</span> new-session)
    (<span class="org-keyword">let</span> ((orig-last-session-buffer (<span class="org-keyword">if</span> (boundp 'xwidget-webkit-last-session-buffer)
                                        xwidget-webkit-last-session-buffer
                                      nil)))
      (<span class="org-keyword">setq</span> xwidget-webkit-last-session-buffer lc/xwidget-webkit-last-session-buffer)
      (<span class="org-keyword">save-window-excursion</span>
        (xwidget-webkit-browse-url url new-session))
      (pop-to-buffer xwidget-webkit-last-session-buffer)
      (<span class="org-keyword">setq</span> lc/xwidget-webkit-last-session-buffer xwidget-webkit-last-session-buffer)
      (<span class="org-keyword">setq</span> xwidget-webkit-last-session-buffer orig-last-session-buffer)))
  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/open-url</span> (url <span class="org-type">&amp;optional</span> other-window new-session)
    (<span class="org-keyword">interactive</span>
     (list
      (read-string  <span class="org-string">"Enter URL or keywords: "</span> nil 'eww-prompt-history <span class="org-string">""</span>)))
    (<span class="org-keyword">if</span> other-window
        (lc/open-url-other-window url new-session)
      (xwidget-webkit-browse-url url new-session))))
</pre>
</div>
</div>
</div>

<div id="outline-container-search-code-on-github" class="outline-3">
<h3 id="search-code-on-github">Search code on github</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">emacs</span>
  <span class="org-builtin">:bind</span>
  (<span class="org-string">"&lt;leader&gt;sc"</span> . 'github-code-search)
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">github-code-search</span> ()
    <span class="org-doc">"Search code on github for a given language."</span>
    (<span class="org-keyword">interactive</span>)
    (<span class="org-keyword">let*</span> ((language (completing-read
                      <span class="org-string">"Language: "</span>
                      '(<span class="org-string">"Emacs+Lisp"</span> <span class="org-string">"Python"</span>  <span class="org-string">"Clojure"</span> <span class="org-string">"R"</span>)))
           (code
            (<span class="org-keyword">thread-last</span>
              (read-string <span class="org-string">"Code: "</span>) (replace-regexp-in-string <span class="org-string">" "</span> <span class="org-string">"+"</span>)))
           (url (concat <span class="org-string">"https://github.com/search?l="</span> language <span class="org-string">"&amp;type=code&amp;q="</span> code)))
      (<span class="org-keyword">if</span> lc/use-xwidget-browser
          (lc/open-url-other-window url)
        (browse-url url)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-search-on-google" class="outline-3">
<h3 id="search-on-google">Search on google</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">emacs</span>
  <span class="org-builtin">:bind</span>
  (<span class="org-string">"&lt;leader&gt;sg"</span> . 'google-search)
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">google-search-str</span> (str)
    (<span class="org-keyword">let*</span> ((keywords (replace-regexp-in-string <span class="org-string">" "</span> <span class="org-string">"+"</span> str))
          (url (concat <span class="org-string">"https://www.google.com/search?q="</span> keywords)))
      (<span class="org-keyword">if</span> lc/use-xwidget-browser
          (lc/open-url-other-window url)
        (browse-url url))))
  (<span class="org-keyword">defun</span> <span class="org-function-name">google-search</span> ()
    <span class="org-doc">"Google search region, if active, or ask for search string."</span>
    (<span class="org-keyword">interactive</span>)
    (<span class="org-keyword">if</span> (region-active-p)
        (google-search-str
         (buffer-substring-no-properties (region-beginning) (region-end)))
      (google-search-str (read-from-minibuffer <span class="org-string">"Search: "</span>)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-no-littering" class="outline-3">
<h3 id="no-littering">no-littering</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">no-littering</span>
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">require</span> '<span class="org-constant">recentf</span>)
  (<span class="org-keyword">require</span> '<span class="org-constant">no-littering</span>)
  (add-to-list 'recentf-exclude no-littering-var-directory)
  (add-to-list 'recentf-exclude no-littering-etc-directory))
</pre>
</div>
</div>
</div>

<div id="outline-container-crafted-modules" class="outline-3">
<h3 id="crafted-modules">Crafted Modules</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">require</span> '<span class="org-constant">crafted-defaults</span>)    <span class="org-comment-delimiter">; </span><span class="org-comment">Sensible default settings for Emacs</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">(require 'crafted-updates)     ; Tools to upgrade Crafted Emacs</span>
(<span class="org-keyword">require</span> '<span class="org-constant">crafted-completion</span>)  <span class="org-comment-delimiter">; </span><span class="org-comment">selection framework based on `vertico`</span>
(<span class="org-keyword">require</span> '<span class="org-constant">crafted-ui</span>)          <span class="org-comment-delimiter">; </span><span class="org-comment">Better UI experience (modeline etc.)</span>
(<span class="org-keyword">require</span> '<span class="org-constant">crafted-windows</span>)     <span class="org-comment-delimiter">; </span><span class="org-comment">Window management configuration</span>
(<span class="org-keyword">require</span> '<span class="org-constant">crafted-editing</span>)     <span class="org-comment-delimiter">; </span><span class="org-comment">Whitspace trimming, auto parens etc.</span>
(<span class="org-keyword">require</span> '<span class="org-constant">lc-osx</span>)
(<span class="org-keyword">require</span> '<span class="org-constant">crafted-evil</span>)        <span class="org-comment-delimiter">; </span><span class="org-comment">An `evil-mode` configuration</span>
(<span class="org-keyword">require</span> '<span class="org-constant">crafted-org</span>)         <span class="org-comment-delimiter">; </span><span class="org-comment">org-appear, clickable hyperlinks etc.</span>
(<span class="org-keyword">require</span> '<span class="org-constant">crafted-project</span>)     <span class="org-comment-delimiter">; </span><span class="org-comment">built-in alternative to projectile</span>
(<span class="org-keyword">require</span> '<span class="org-constant">crafted-startup</span>)     <span class="org-comment-delimiter">; </span><span class="org-comment">splash scren</span>
(<span class="org-keyword">require</span> '<span class="org-constant">crafted-workspaces</span>)
<span class="org-comment-delimiter">;; </span><span class="org-comment">(require 'crafted-speedbar)    ; built-in file-tree</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">(require 'crafted-screencast)  ; show current command and binding in modeline</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">(require 'crafted-compile)     ; automatically compile some emacs lisp files</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">(require 'crafted-python)</span>
(<span class="org-keyword">require</span> '<span class="org-constant">crafted-ide</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-popup-management" class="outline-3">
<h3 id="popup-management">Popup management</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">emacs</span>
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> display-buffer-alist
        `((,(<span class="org-keyword">rx</span> bos (<span class="org-keyword">or</span> <span class="org-string">"*Apropos*"</span> <span class="org-string">"*Help*"</span> <span class="org-string">"*helpful"</span> <span class="org-string">"*info*"</span> <span class="org-string">"*Summary*"</span>) (0+ not-newline))
           (display-buffer-reuse-mode-window display-buffer-below-selected)
           (window-height . 0.33)
           (mode apropos-mode help-mode helpful-mode Info-mode Man-mode))))
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-start-server" class="outline-3">
<h3 id="start-server">Start server</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">emacs</span>
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">unless</span> (<span class="org-keyword">and</span> (fboundp 'server-running-p) (server-running-p))
    (server-start)))
</pre>
</div>
</div>
</div>

<div id="outline-container-don-t-compile-jupyter" class="outline-3">
<h3 id="don-t-compile-jupyter">Don't compile jupyter</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">emacs</span>
  <span class="org-builtin">:init</span>
  (add-to-list 'native-comp-bootstrap-deny-list <span class="org-string">".*jupyter.*"</span>)
  (add-to-list 'native-comp-jit-compilation-deny-list <span class="org-string">".*jupyter.*"</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-add-vc-keyword-to-use-package" class="outline-3">
<h3 id="add-vc-keyword-to-use-package">add :vc keyword to use-package</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">emacs</span>
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">unless</span> (package-installed-p 'vc-use-package)
    (package-vc-install <span class="org-string">"https://github.com/slotThe/vc-use-package"</span>))
  (<span class="org-keyword">require</span> '<span class="org-constant">vc-use-package</span>))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-user-interface" class="outline-2">
<h2 id="user-interface">User interface</h2>
<div class="outline-text-2" id="text-user-interface">
</div>
<div id="outline-container-maximize-frame-on-startup" class="outline-3">
<h3 id="maximize-frame-on-startup">Maximize frame on startup</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">emacs</span>
  <span class="org-builtin">:init</span>
  (add-hook 'window-setup-hook 'toggle-frame-maximized t))
</pre>
</div>
</div>
</div>

<div id="outline-container-modus-themes" class="outline-3">
<h3 id="modus-themes">Modus themes</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">emacs</span>
  <span class="org-builtin">:init</span>
  (require-theme 'modus-themes)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">Add all your customizations prior to loading the themes</span>
  (<span class="org-keyword">setq</span> modus-themes-italic-constructs t
        modus-themes-org-blocks 'greyscale <span class="org-comment-delimiter">; </span><span class="org-comment">{nil,'greyscale,'rainbow}</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">modus-themes-variable-pitch-ui t</span>
        modus-themes-bold-constructs nil)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">define some palette overrides</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/override-colors</span> ()
    (<span class="org-keyword">setq</span> modus-themes-operandi-color-overrides
          '((bg-main . <span class="org-string">"#fefcf4"</span>)
            (bg-dim . <span class="org-string">"#faf6ef"</span>)
            (bg-alt . <span class="org-string">"#f7efe5"</span>)
            (bg-hl-line . <span class="org-string">"#f4f0e3"</span>)
            (bg-active . <span class="org-string">"#e8dfd1"</span>)
            (bg-inactive . <span class="org-string">"#f6ece5"</span>)
            (bg-region . <span class="org-string">"#c6bab1"</span>)
            (bg-header . <span class="org-string">"#ede3e0"</span>)
            (bg-tab-bar . <span class="org-string">"#dcd3d3"</span>)
            (bg-tab-active . <span class="org-string">"#fdf6eb"</span>)
            (bg-tab-inactive . <span class="org-string">"#c8bab8"</span>)
            (fg-unfocused .<span class="org-string">"#55556f"</span>)))
    (<span class="org-keyword">setq</span> modus-themes-vivendi-color-overrides
          '((bg-main . <span class="org-string">"#100b17"</span>)
            (bg-dim . <span class="org-string">"#161129"</span>)
            (bg-alt . <span class="org-string">"#181732"</span>)
            (bg-hl-line . <span class="org-string">"#191628"</span>)
            (bg-active . <span class="org-string">"#282e46"</span>)
            (bg-inactive . <span class="org-string">"#1a1e39"</span>)
            (bg-region . <span class="org-string">"#393a53"</span>)
            (bg-header . <span class="org-string">"#202037"</span>)
            (bg-tab-bar . <span class="org-string">"#262b41"</span>)
            (bg-tab-active . <span class="org-string">"#120f18"</span>)
            (bg-tab-inactive . <span class="org-string">"#3a3a5a"</span>)
            (fg-unfocused . <span class="org-string">"#9a9aab"</span>))))

  (lc/override-colors)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">first turn off the deeper-blue theme</span>
  (disable-theme 'deeper-blue)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">poor man's way of checking the hour when emacs is started</span>
  (<span class="org-keyword">if</span> (<span class="org-keyword">and</span> (&lt; (string-to-number (format-time-string <span class="org-string">"%H"</span>)) <span class="org-comment-delimiter">;; </span><span class="org-comment">&gt;</span>
              19)
           (not (&lt; (string-to-number (format-time-string <span class="org-string">"%H"</span>)) 6 <span class="org-comment-delimiter">;; </span><span class="org-comment">&gt;</span>
                   )))
      <span class="org-comment-delimiter">;; </span><span class="org-comment">light theme</span>
      (load-theme 'modus-operandi <span class="org-builtin">:no-confim</span>)
    <span class="org-comment-delimiter">;; </span><span class="org-comment">dark theme</span>
    (load-theme 'modus-vivendi <span class="org-builtin">:no-confim</span>))

  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/modus-themes-toggle</span> ()
    <span class="org-doc">"Toggle between `</span><span class="org-doc"><span class="org-constant">modus-operandi</span></span><span class="org-doc">' and `</span><span class="org-doc"><span class="org-constant">modus-vivendi</span></span><span class="org-doc">' themes.</span>
<span class="org-doc">This uses `</span><span class="org-doc"><span class="org-constant">enable-theme</span></span><span class="org-doc">' instead of the standard method of</span>
<span class="org-doc">`</span><span class="org-doc"><span class="org-constant">load-theme</span></span><span class="org-doc">'.  The technicalities are covered in the Modus themes</span>
<span class="org-doc">manual."</span>
    (<span class="org-keyword">interactive</span>)
    (<span class="org-keyword">pcase</span> (modus-themes--current-theme)
      ('modus-operandi (<span class="org-keyword">progn</span> (disable-theme 'modus-operandi)
                              (load-theme 'modus-vivendi <span class="org-builtin">:no-confirm</span>)))
      ('modus-vivendi (<span class="org-keyword">progn</span> (disable-theme 'modus-vivendi)
                             (load-theme 'modus-operandi <span class="org-builtin">:no-confirm</span>)))
      (_ (<span class="org-warning">error</span> <span class="org-string">"No Modus theme is loaded; evaluate `</span><span class="org-string"><span class="org-constant">modus-themes-load-themes</span></span><span class="org-string">' first"</span>)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-add-frame-borders" class="outline-3">
<h3 id="add-frame-borders">Add frame borders</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">emacs</span>
  <span class="org-builtin">:init</span>
  (modify-all-frames-parameters
   '((right-divider-width . 10)
     (internal-border-width . 10)))
  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/hide-divider-and-fringe</span> ()
    (<span class="org-keyword">dolist</span> (face '(window-divider
                    window-divider-first-pixel
                    window-divider-last-pixel))
      (face-spec-reset-face face)
      (set-face-foreground face (face-attribute 'default <span class="org-builtin">:background</span>)))
    (set-face-background 'fringe (face-attribute 'default <span class="org-builtin">:background</span>)))
  <span class="org-comment-delimiter">;; </span><span class="org-comment">call it once at init time</span>
  (lc/hide-divider-and-fringe)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">call it every time the theme changes</span>
  (advice-add 'lc/modus-themes-toggle
              <span class="org-builtin">:after</span> (<span class="org-keyword">lambda</span> () (<span class="org-keyword">interactive</span>) (lc/hide-divider-and-fringe))))
</pre>
</div>
</div>
</div>

<div id="outline-container-inhibit-startup-screen" class="outline-3">
<h3 id="inhibit-startup-screen">Inhibit startup screen</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">emacs</span>
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> crafted-startup-inhibit-splash t))
</pre>
</div>
</div>
</div>

<div id="outline-container-all-the-icons-completion" class="outline-3">
<h3 id="all-the-icons-completion">all-the-icons completion</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">all-the-icons-completion</span>
  <span class="org-builtin">:if</span> (display-graphic-p)
  <span class="org-builtin">:after</span> (marginalia all-the-icons)
  <span class="org-builtin">:hook</span> (marginalia-mode . all-the-icons-completion-marginalia-setup)
  <span class="org-builtin">:init</span>
  (all-the-icons-completion-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-doom-modeline" class="outline-3">
<h3 id="doom-modeline">Doom modeline</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">doom-modeline</span>
  <span class="org-builtin">:hook</span>
  (after-init . doom-modeline-mode)
  <span class="org-builtin">:custom</span>
  (doom-modeline-buffer-encoding nil)
  (doom-modeline-env-enable-python nil)
  (doom-modeline-height 15)
  (doom-modeline-workspace-name nil)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">(doom-modeline-project-detection 'projectile)</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">(doom-modeline-buffer-file-name-style 'relative-to-project)</span>
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-highlight-todo" class="outline-3">
<h3 id="highlight-todo">highlight todo</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">hl-todo</span>
  <span class="org-builtin">:hook</span>
  ((prog-mode org-mode) . lc/hl-todo-init)
  <span class="org-builtin">:preface</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/hl-todo-init</span> ()
    (<span class="org-keyword">setq-local</span> hl-todo-keyword-faces '((<span class="org-string">"HOLD"</span> . <span class="org-string">"#d0bf8f"</span>)
                                        (<span class="org-string">"MAYBE"</span> . <span class="org-string">"#d0bf8f"</span>)
                                        (<span class="org-string">"TODO"</span> . <span class="org-string">"#cc9393"</span>)
                                        (<span class="org-string">"NEXT"</span> . <span class="org-string">"#dca3a3"</span>)
                                        (<span class="org-string">"THEM"</span> . <span class="org-string">"#dc8cc3"</span>)
                                        (<span class="org-string">"PROG"</span> . <span class="org-string">"#7cb8bb"</span>)
                                        (<span class="org-string">"KILL"</span> . <span class="org-string">"#5f7f5f"</span>)
                                        (<span class="org-string">"DONE"</span> . <span class="org-string">"#afd8af"</span>)
                                        (<span class="org-string">"FIXME"</span> . <span class="org-string">"#cc9393"</span>)))
    (hl-todo-mode)))
</pre>
</div>
</div>
</div>

<div id="outline-container-kind-icon" class="outline-3">
<h3 id="kind-icon">kind icon</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">kind-icon</span>
  <span class="org-builtin">:after</span> corfu
  <span class="org-builtin">:custom</span>
  (kind-icon-default-face 'corfu-default) <span class="org-comment-delimiter">; </span><span class="org-comment">to compute blended backgrounds correctly</span>
  (kind-icon-blend-background nil)  <span class="org-comment-delimiter">; </span><span class="org-comment">Use midpoint color between foreground and background colors ("blended")?</span>
  (kind-icon-blend-frac 0.08)
  <span class="org-builtin">:config</span>
  (add-to-list 'corfu-margin-formatters #'kind-icon-margin-formatter)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">refresh kind icon cache to match theme</span>
  (add-hook 'modus-themes-after-load-theme-hook
            #'(<span class="org-keyword">lambda</span> () (<span class="org-keyword">interactive</span>) (kind-icon-reset-cache)))
)
</pre>
</div>
</div>
</div>

<div id="outline-container-centered-cursor-mode" class="outline-3">
<h3 id="centered-cursor-mode">centered cursor mode</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">centered-cursor-mode</span>
  <span class="org-builtin">:bind</span>
  (<span class="org-string">"&lt;leader&gt;t="</span> . (<span class="org-keyword">lambda</span> () (<span class="org-keyword">interactive</span>) (centered-cursor-mode 'toggle))))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-evil" class="outline-2">
<h2 id="evil">Evil</h2>
<div class="outline-text-2" id="text-evil">
</div>
<div id="outline-container-evil-mode" class="outline-3">
<h3 id="evil-mode">evil mode</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">evil</span>
  <span class="org-builtin">:hook</span>
  (edebug-mode . (<span class="org-keyword">lambda</span> () (<span class="org-keyword">require</span> '<span class="org-constant">evil-collection-edebug</span>) (evil-normalize-keymaps)))
  <span class="org-builtin">:custom</span>
  (evil-want-C-u-scroll t)
  (evil-want-C-i-jump t)
  (evil-lookup-func #'helpful-at-point)
  (evil-want-Y-yank-to-eol t)
  (evil-split-window-below t)
  (evil-vsplit-window-right t)
  (evil-auto-indent nil)
  <span class="org-builtin">:config</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">set leader key in normal state</span>
  (evil-set-leader 'normal (kbd <span class="org-string">"SPC"</span>))
  (evil-set-leader 'insert (kbd <span class="org-string">"C-SPC"</span>))
  (evil-set-leader 'visual (kbd <span class="org-string">"SPC"</span>))
  <span class="org-comment-delimiter">;; </span><span class="org-comment">set local leader</span>
  (evil-set-leader 'normal <span class="org-string">","</span> t)
  (evil-set-leader 'insert (kbd <span class="org-string">"C-,"</span>) t)
  (evil-set-leader 'visual <span class="org-string">","</span> t)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">ESC key</span>
  (define-key evil-insert-state-map (kbd <span class="org-string">"ESC"</span>) 'evil-normal-state)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">set up motion keys</span>
  (define-key evil-motion-state-map <span class="org-string">"_"</span> 'evil-end-of-line)
  (define-key evil-motion-state-map <span class="org-string">"0"</span> 'evil-beginning-of-line)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">unbind C-p so consult can use it</span>
  (define-key evil-normal-state-map (kbd <span class="org-string">"C-p"</span>) nil)
  (define-key evil-insert-state-map (kbd <span class="org-string">"C-p"</span>) nil)
  (<span class="org-keyword">with-eval-after-load</span> 'evil-maps
    (define-key evil-motion-state-map (kbd <span class="org-string">"SPC"</span>) nil)
    (define-key evil-motion-state-map (kbd <span class="org-string">"RET"</span>) nil)
    (define-key evil-motion-state-map (kbd <span class="org-string">"TAB"</span>) nil))
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-eval-operator" class="outline-3">
<h3 id="eval-operator">eval operator</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">evil</span>
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">defcustom</span> <span class="org-variable-name">evil-extra-operator-eval-modes-alist</span>
    '((emacs-lisp-mode eros-eval-region)
      (org-mode eros-eval-region)
      <span class="org-comment-delimiter">;; </span><span class="org-comment">(scheme-mode geiser-eval-region)</span>
      (clojure-mode cider-eval-region)
      (jupyter-repl-interaction-mode jupyter-eval-line-or-region)
      (python-ts-mode jupyter-eval-region)
      <span class="org-comment-delimiter">;; </span><span class="org-comment">(python-mode python-shell-send-region) ;; when executing in org-src-edit mode</span>
      )
    <span class="org-doc">"Alist used to determine evil-operator-eval's behaviour.</span>
<span class="org-doc">Each element of this alist should be of this form:</span>
<span class="org-doc"> (MAJOR-MODE EVAL-FUNC [ARGS...])</span>
<span class="org-doc">MAJOR-MODE denotes the major mode of buffer. EVAL-FUNC should be a function</span>
<span class="org-doc">with at least 2 arguments: the region beginning and the region end. ARGS will</span>
<span class="org-doc">be passed to EVAL-FUNC as its rest arguments"</span>
    <span class="org-builtin">:type</span> '(alist <span class="org-builtin">:key-type</span> symbol)
    <span class="org-builtin">:group</span> 'evil-extra-operator)
  (evil-define-operator evil-operator-eval (beg end)
    <span class="org-string">"Evil operator for evaluating code."</span>
    <span class="org-builtin">:move-point</span> nil
    (<span class="org-keyword">interactive</span> <span class="org-string">"&lt;r&gt;"</span>)
    (<span class="org-keyword">let*</span> (<span class="org-comment-delimiter">;; </span><span class="org-comment">(mode (if (and (eq major-mode 'org-mode) (org-in-src-block-p))</span>
           <span class="org-comment-delimiter">;;           </span><span class="org-comment">(intern (car (org-babel-get-src-block-info)))</span>
           <span class="org-comment-delimiter">;;         </span><span class="org-comment">major-mode))</span>
           (mode major-mode)
           (ele (assoc mode evil-extra-operator-eval-modes-alist))
           (f-a (cdr-safe ele))
           (func (car-safe f-a))
           (args (cdr-safe f-a)))
      (<span class="org-keyword">if</span> (fboundp func)
          (<span class="org-keyword">save-mark-and-excursion</span> (apply func beg end args))
        (eval-region beg end t))))
  (define-key emacs-lisp-mode-map (kbd <span class="org-string">"&lt;normal-state&gt; gr"</span>) nil)
  (define-key evil-motion-state-map <span class="org-string">"gr"</span> 'evil-operator-eval)
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-evil-org-mode-org-text-objects" class="outline-3">
<h3 id="evil-org-mode-org-text-objects">evil-org-mode, org text objects</h3>
<div class="outline-text-3">
<p>
Text objects:
</p>
<dl class="org-dl">
<dt><code>e</code></dt><dd>code block</dd>
<dt><code>R</code></dt><dd>subtree</dd>
</dl>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">evil-org-mode</span>
  <span class="org-builtin">:vc</span> (<span class="org-builtin">:fetcher</span> <span class="org-string">"github"</span> <span class="org-builtin">:repo</span> <span class="org-string">"hlissner/evil-org-mode"</span>)
  <span class="org-builtin">:bind</span>
  ([remap evil-org-org-insert-heading-respect-content-below] . +org/insert-item-below) <span class="org-comment-delimiter">;; </span><span class="org-comment">"&lt;C-return&gt;"</span>
  ([remap evil-org-org-insert-todo-heading-respect-content-below] . +org/insert-item-above) <span class="org-comment-delimiter">;; </span><span class="org-comment">"&lt;C-S-return&gt;"</span>
  (<span class="org-builtin">:map</span> org-mode-map
        (<span class="org-string">"RET"</span> . 'org-open-at-point))
  <span class="org-builtin">:hook</span>
  (org-mode . lc/init-evil-org-mode)
  <span class="org-builtin">:preface</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/init-evil-org-mode</span> ()
    (<span class="org-keyword">require</span> '<span class="org-constant">evil-org</span>)
    (evil-normalize-keymaps)
    (evil-org-set-key-theme '(textobjects))
    (<span class="org-keyword">require</span> '<span class="org-constant">evil-org-agenda</span>)
    (evil-org-agenda-set-keys)
    (evil-org-mode)
    <span class="org-comment-delimiter">;; </span><span class="org-comment">disable annoying insert-new-line-and-indent behavior</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">(define-key evil-org-mode-map (kbd "&lt;normal-state&gt;o") nil)</span>
    )
  (<span class="org-keyword">defun</span> <span class="org-function-name">+org--insert-item</span> (direction)
    (<span class="org-keyword">let</span> ((context (org-element-lineage
                    (org-element-context)
                    '(table table-row headline inlinetask item plain-list)
                    t)))
      (<span class="org-keyword">pcase</span> (org-element-type context)
        <span class="org-comment-delimiter">;; </span><span class="org-comment">Add a new list item (carrying over checkboxes if necessary)</span>
        ((<span class="org-keyword">or</span> `item `plain-list)
         <span class="org-comment-delimiter">;; </span><span class="org-comment">Position determines where org-insert-todo-heading and org-insert-item</span>
         <span class="org-comment-delimiter">;; </span><span class="org-comment">insert the new list item.</span>
         (<span class="org-keyword">if</span> (eq direction 'above)
             (org-beginning-of-item)
           (org-end-of-item)
           (backward-char))
         (org-insert-item (org-element-property <span class="org-builtin">:checkbox</span> context))
         <span class="org-comment-delimiter">;; </span><span class="org-comment">Handle edge case where current item is empty and bottom of list is</span>
         <span class="org-comment-delimiter">;; </span><span class="org-comment">flush against a new heading.</span>
         (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> (eq direction 'below)
                    (eq (org-element-property <span class="org-builtin">:contents-begin</span> context)
                        (org-element-property <span class="org-builtin">:contents-end</span> context)))
           (org-end-of-item)
           (org-end-of-line)))

        <span class="org-comment-delimiter">;; </span><span class="org-comment">Add a new table row</span>
        ((<span class="org-keyword">or</span> `table `table-row)
         (<span class="org-keyword">pcase</span> direction
           ('below (<span class="org-keyword">save-excursion</span> (org-table-insert-row t))
                   (org-table-next-row))
           ('above (<span class="org-keyword">save-excursion</span> (org-shiftmetadown))
                   (+org/table-previous-row))))

        <span class="org-comment-delimiter">;; </span><span class="org-comment">Otherwise, add a new heading, carrying over any todo state, if</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">necessary.</span>
        (_
         (<span class="org-keyword">let</span> ((level (<span class="org-keyword">or</span> (org-current-level) 1)))
           <span class="org-comment-delimiter">;; </span><span class="org-comment">I intentionally avoid `</span><span class="org-comment"><span class="org-constant">org-insert-heading</span></span><span class="org-comment">' and the like because they</span>
           <span class="org-comment-delimiter">;; </span><span class="org-comment">impose unpredictable whitespace rules depending on the cursor</span>
           <span class="org-comment-delimiter">;; </span><span class="org-comment">position. It's simpler to express this command's responsibility at a</span>
           <span class="org-comment-delimiter">;; </span><span class="org-comment">lower level than work around all the quirks in org's API.</span>
           (<span class="org-keyword">pcase</span> direction
             (`below
              (<span class="org-keyword">let</span> (org-insert-heading-respect-content)
                (goto-char (line-end-position))
                (org-end-of-subtree)
                (insert <span class="org-string">"\n"</span> (make-string level ?*) <span class="org-string">" "</span>)))
             (`above
              (org-back-to-heading)
              (insert (make-string level ?*) <span class="org-string">" "</span>)
              (<span class="org-keyword">save-excursion</span> (insert <span class="org-string">"\n"</span>))))
           (<span class="org-keyword">when-let*</span> ((todo-keyword (org-element-property <span class="org-builtin">:todo-keyword</span> context))
                       (todo-type    (org-element-property <span class="org-builtin">:todo-type</span> context)))
             (org-todo
              (<span class="org-keyword">cond</span> ((eq todo-type 'done)
                     <span class="org-comment-delimiter">;; </span><span class="org-comment">Doesn't make sense to create more "DONE" headings</span>
                     (car (+org-get-todo-keywords-for todo-keyword)))
                    (todo-keyword)
                    ('todo)))))))

      (<span class="org-keyword">when</span> (org-invisible-p)
        (org-show-hidden-entry))
      (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> (<span class="org-keyword">bound-and-true-p</span> evil-local-mode)
                 (not (evil-emacs-state-p)))
        (evil-insert 1))))

  (<span class="org-keyword">defun</span> <span class="org-function-name">+org/insert-item-below</span> (count)
    <span class="org-doc">"Inserts a new heading, table cell or item below the current one."</span>
    (<span class="org-keyword">interactive</span> <span class="org-string">"p"</span>)
    (<span class="org-keyword">dotimes</span> (_ count) (+org--insert-item 'below)))

  (<span class="org-keyword">defun</span> <span class="org-function-name">+org/insert-item-above</span> (count)
    <span class="org-doc">"Inserts a new heading, table cell or item above the current one."</span>
    (<span class="org-keyword">interactive</span> <span class="org-string">"p"</span>)
    (<span class="org-keyword">dotimes</span> (_ count) (+org--insert-item 'above))))
</pre>
</div>
</div>
</div>

<div id="outline-container-evil-nerd-commenter" class="outline-3">
<h3 id="evil-nerd-commenter">evil nerd commenter</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">evil-nerd-commenter</span>
  <span class="org-builtin">:bind</span>
  (<span class="org-builtin">:map</span> evil-normal-state-map
        (<span class="org-string">"gc"</span> . 'evilnc-comment-operator)
        (<span class="org-string">"gC"</span> . 'evilnc-copy-and-comment-operator))
  (<span class="org-builtin">:map</span> evil-visual-state-map
        (<span class="org-string">"gc"</span> . 'evilnc-comment-operator)
        (<span class="org-string">"gC"</span> . 'evilnc-copy-and-comment-operator)))
</pre>
</div>
</div>
</div>

<div id="outline-container-evil-surround" class="outline-3">
<h3 id="evil-surround">evil surround</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">evil-surround</span>
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">with-eval-after-load</span> 'evil
    (global-evil-surround-mode)))
</pre>
</div>
</div>
</div>

<div id="outline-container-evil-goggles" class="outline-3">
<h3 id="evil-goggles">evil goggles</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">evil-goggles</span>
  <span class="org-builtin">:after</span> evil
  <span class="org-builtin">:custom</span>
  (evil-goggles-duration 0.1)
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">push</span> '(evil-operator-eval
          <span class="org-builtin">:face</span> evil-goggles-yank-face
          <span class="org-builtin">:switch</span> evil-goggles-enable-yank
          <span class="org-builtin">:advice</span> evil-goggles--generic-async-advice)
        evil-goggles--commands)
  (evil-goggles-mode)
  (evil-goggles-use-diff-faces))
</pre>
</div>
</div>
</div>

<div id="outline-container-evil-cleverparens-outer-form-text-object" class="outline-3">
<h3 id="evil-cleverparens-outer-form-text-object">evil cleverparens, outer form text object</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">evil-cleverparens</span>
  <span class="org-builtin">:after</span> (evil)
  <span class="org-builtin">:hook</span>
  (emacs-lisp-mode . lc/init-cleverparens)
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/init-cleverparens</span> ()
    (<span class="org-keyword">require</span> '<span class="org-constant">evil-cleverparens-util</span>)
    (evil-define-text-object evil-cp-a-defun (count <span class="org-type">&amp;optional</span> beg end type)
      <span class="org-string">"An outer text object for a top level sexp (defun)."</span>
      (<span class="org-keyword">if</span> (evil-cp--inside-form-p)
          (<span class="org-keyword">let</span> ((bounds (evil-cp--top-level-bounds)))
            (evil-range (car bounds) (cdr bounds) 'inclusive <span class="org-builtin">:expanded</span> t))
        (<span class="org-warning">error</span> <span class="org-string">"Not inside a sexp."</span>)))

    (evil-define-text-object evil-cp-inner-defun (count <span class="org-type">&amp;optional</span> beg end type)
      <span class="org-string">"An inner text object for a top level sexp (defun)."</span>
      (<span class="org-keyword">if</span> (evil-cp--inside-form-p)
          (<span class="org-keyword">let</span> ((bounds (evil-cp--top-level-bounds)))
            (evil-range (1+ (car bounds)) (1- (cdr bounds)) 'inclusive <span class="org-builtin">:expanded</span> t))
        (<span class="org-warning">error</span> <span class="org-string">"Not inside a sexp."</span>)))

    (define-key evil-outer-text-objects-map <span class="org-string">"f"</span> #'evil-cp-a-defun)
    (define-key evil-inner-text-objects-map <span class="org-string">"f"</span> #'evil-cp-inner-defun)
    ))
</pre>
</div>
</div>
</div>

<div id="outline-container-evil-buffer-text-object" class="outline-3">
<h3 id="evil-buffer-text-object">evil buffer text object</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">evil</span>
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">defgroup</span> <span class="org-type">evil-textobj-entire</span> nil
    <span class="org-doc">"Text object entire buffer for Evil"</span>
    <span class="org-builtin">:prefix</span> <span class="org-string">"evil-textobj-entire-"</span>
    <span class="org-builtin">:group</span> 'evil)

  (<span class="org-keyword">defcustom</span> <span class="org-variable-name">evil-textobj-entire-key</span> <span class="org-string">"g"</span>
    <span class="org-doc">"Key for evil-inner-entire"</span>
    <span class="org-builtin">:type</span> 'string
    <span class="org-builtin">:group</span> 'evil-textobj-entire)

  (evil-define-text-object evil-entire-entire-buffer (count <span class="org-type">&amp;optional</span> beg end type)
    <span class="org-string">"Select entire buffer"</span>
    (evil-range (point-min) (point-max)))

  (define-key evil-outer-text-objects-map evil-textobj-entire-key 'evil-entire-entire-buffer)
  (define-key evil-inner-text-objects-map evil-textobj-entire-key 'evil-entire-entire-buffer)
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-evil-iedit-state" class="outline-3">
<h3 id="evil-iedit-state">evil-iedit-state</h3>
<div class="outline-text-3">
<p>
Keybindings:
</p>
<dl class="org-dl">
<dt><code>TAB</code></dt><dd>toggle occurrence</dd>
<dt><code>n</code> / <code>N</code></dt><dd>next/prev occurrence</dd>
<dt><code>F</code></dt><dd>restrict scope to function</dd>
<dt><code>J</code> / <code>K</code></dt><dd>extend scope of match down/up</dd>
<dt><code>V</code></dt><dd>toggle visibility of matches</dd>
</dl>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">evil-iedit-state</span>
  <span class="org-builtin">:vc</span> (<span class="org-builtin">:fetcher</span> github <span class="org-builtin">:repo</span> <span class="org-string">"kassick/evil-iedit-state"</span>)
  <span class="org-builtin">:bind</span>
  (<span class="org-string">"&lt;leader&gt;se"</span> . 'iedit-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-evil-snipe" class="outline-3">
<h3 id="evil-snipe">evil-snipe</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">evil-snipe</span>
  <span class="org-builtin">:hook</span>
  (evil-local-mode . evil-snipe-local-mode)
  <span class="org-builtin">:custom</span>
  (evil-snipe-spillover-scope 'whole-visible)
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">evil-snipe--collect-keys</span> (<span class="org-type">&amp;optional</span> count forward-p)
    (<span class="org-keyword">let</span> ((echo-keystrokes 0) <span class="org-comment-delimiter">; </span><span class="org-comment">don't mess with the prompt, Emacs</span>
          (count (<span class="org-keyword">or</span> count 1))
          (i evil-snipe--match-count)
          keys)
      (<span class="org-keyword">unless</span> forward-p
        (<span class="org-keyword">setq</span> count (- count)))
      (<span class="org-keyword">unwind-protect</span>
          (<span class="org-keyword">catch</span> '<span class="org-constant">abort</span>
            (<span class="org-keyword">while</span> (&gt; i 0)
              (<span class="org-keyword">let*</span> ((prompt (format <span class="org-string">"%d&gt;%s"</span> i (mapconcat #'char-to-string keys <span class="org-string">""</span>)))
                     (key (evil-read-key (<span class="org-keyword">if</span> evil-snipe-show-prompt prompt))))
                (<span class="org-keyword">cond</span>
                 <span class="org-comment-delimiter">;; </span><span class="org-comment">TAB adds more characters if `</span><span class="org-comment"><span class="org-constant">evil-snipe-tab-increment</span></span><span class="org-comment">'</span>
                 ((<span class="org-keyword">and</span> evil-snipe-tab-increment (eq key ?\t))  <span class="org-comment-delimiter">;; </span><span class="org-comment">TAB</span>
                  (<span class="org-keyword">cl-incf</span> i))
                 <span class="org-comment-delimiter">;; </span><span class="org-comment">Enter starts search with current chars</span>
                 ((memq key '(?\r ?\n))  <span class="org-comment-delimiter">;; </span><span class="org-comment">RET</span>
                  (<span class="org-keyword">throw</span> '<span class="org-constant">abort</span> (<span class="org-keyword">if</span> (= i evil-snipe--match-count) 'repeat keys)))
                 <span class="org-comment-delimiter">;; </span><span class="org-comment">Abort</span>
                 ((eq key ?\e)  <span class="org-comment-delimiter">;; </span><span class="org-comment">ESC</span>
                  (evil-snipe--cleanup)
                  (<span class="org-keyword">throw</span> '<span class="org-constant">abort</span> 'abort))
                 (t <span class="org-comment-delimiter">; </span><span class="org-comment">Otherwise, process key</span>
                  (<span class="org-keyword">cond</span> ((eq key ?\d)  <span class="org-comment-delimiter">; </span><span class="org-comment">DEL (backspace) deletes a character</span>
                         (<span class="org-keyword">cl-incf</span> i)
                         (<span class="org-keyword">if</span> (&lt;= (length keys) 1)
                             (<span class="org-keyword">progn</span> (evil-snipe--cleanup)
                                    (<span class="org-keyword">throw</span> '<span class="org-constant">abort</span> 'abort))
                           (nbutlast keys)))
                        (t <span class="org-comment-delimiter">;; </span><span class="org-comment">Otherwise add it</span>
                         (<span class="org-keyword">setq</span> keys (append keys (list key)))
                         (<span class="org-keyword">cl-decf</span> i)))
                  (<span class="org-keyword">when</span> evil-snipe-enable-incremental-highlight
                    (evil-snipe--cleanup)
                    (evil-snipe--highlight-all count keys)
                    (add-hook 'pre-command-hook #'evil-snipe--cleanup))))))
            keys))))
  )
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-gpt-interface" class="outline-2">
<h2 id="gpt-interface">GPT interface</h2>
<div class="outline-text-2" id="text-gpt-interface">
</div>
<div id="outline-container-notes" class="outline-3">
<h3 id="notes">Notes</h3>
<div class="outline-text-3">
<p>
Interesting ideas:
</p>
<ul class="org-ul">
<li>Generating fake data/dataframe</li>
<li>Writing unit tests for a function</li>
<li>Checking function code for errors / edge cases</li>
<li>Convert between languages (R to python) or libraries (pandas to polars)</li>
<li>Ask itinerary for a road trip</li>
<li>Reply in a code block / tabular form</li>
</ul>

<p>
<a href="https://github.com/f/awesome-chatgpt-prompts">Awesome chatgpt prompts</a>:
</p>
<ul class="org-ul">
<li><a href="https://github.com/f/awesome-chatgpt-prompts#act-as-an-english-translator-and-improver">Act as an English Translator and Improver</a></li>
<li><a href="https://github.com/f/awesome-chatgpt-prompts#act-as-a-midjourney-prompt-generator">Act as a prompt generator for DALL-E</a></li>
<li><a href="https://github.com/f/awesome-chatgpt-prompts#act-as-an-ascii-artist">Act as an ASCII artist</a></li>
<li><a href="https://github.com/f/awesome-chatgpt-prompts#act-as-a-statistician">Act as a statistician</a></li>
<li><a href="https://github.com/f/awesome-chatgpt-prompts#act-as-a-psychologist">Act as a psychologist</a></li>
<li><a href="https://github.com/f/awesome-chatgpt-prompts#act-as-a-scientific-data-visualizer">Act as a scientific data visualizer</a></li>
<li><a href="https://github.com/f/awesome-chatgpt-prompts#act-as-a-regex-generator">Act as a Regex Generator</a></li>
<li><a href="https://github.com/f/awesome-chatgpt-prompts#act-as-a-diagram-generator">Act as a Diagram Generator</a></li>
<li><a href="https://github.com/f/awesome-chatgpt-prompts#act-as-a-song-recommender">Act as a song recommender</a></li>
<li><a href="https://github.com/f/awesome-chatgpt-prompts#act-as-a-wikipedia-page">Act as a Wikipedia page</a></li>
</ul>

<p>
About <code>temperature</code>:
</p>
<blockquote>
<p>
Setting the API temperature to 0, or close to zero (such as 0.1 or
0.2) tends to give better results in most cases.  In cases where you
need Codex to provide different potential results, start at zero and
then increment upwards by .1 until you find suitable variation.
</p>
</blockquote>

<p>
Best practices for writing a function:
</p>
<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">def</span> <span class="org-function-name">getUserBalance</span>(<span class="org-builtin">id</span>):
    <span class="org-doc">"""</span>
<span class="org-doc">    Look up the user in the database &#8216;UserData' and return their current account balance.</span>
<span class="org-doc">    """</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-complete-region-buffer-with-gpt" class="outline-3">
<h3 id="complete-region-buffer-with-gpt">Complete region/buffer with gpt</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">emacs</span>
  <span class="org-builtin">:bind</span>
  (<span class="org-string">"&lt;leader&gt;cb"</span> . 'lc/gpt-complete-buffer-and-insert)
  (<span class="org-string">"&lt;leader&gt;op"</span> . (<span class="org-keyword">lambda</span> () (<span class="org-keyword">interactive</span>)
                    (find-file-other-window lc/gpt-prompts-file)))
  (<span class="org-builtin">:map</span> evil-visual-state-map
        (<span class="org-string">"&lt;leader&gt;cr"</span> . 'lc/gpt-complete-region-and-insert)
        (<span class="org-string">"&lt;leader&gt;cp"</span> . 'lc/gpt-complete-with-prompt-prefix-and-insert))
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> lc/gpt-api-key-getter (<span class="org-keyword">lambda</span> () (auth-source-pick-first-password <span class="org-builtin">:host</span> <span class="org-string">"chat.openai.com"</span>)))
  <span class="org-comment-delimiter">;; </span><span class="org-comment">(setq lc/gpt-model 'text-davinci-003)</span>
  (<span class="org-keyword">setq</span> lc/gpt-model 'gpt-3.5-turbo-0301)
  (<span class="org-keyword">setq</span> lc/gpt-max-output-tokens 2000)
  (<span class="org-keyword">setq</span> lc/gpt-temperature 0.1)
  (<span class="org-keyword">setq</span> lc/gpt-top-p 0.1)
  (<span class="org-keyword">setq</span> lc/gpt-frequency-penalty 0)
  (<span class="org-keyword">setq</span> lc/gpt-presence-penalty 0)
  (<span class="org-keyword">setq</span> lc/gpt-prompt-prefix-alist '((<span class="org-string">"complete"</span> . <span class="org-string">"Complete the following code."</span>)))

  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/gpt-complete-str</span> (api-key prompt-or-messages)
    <span class="org-doc">"Return the prompt answer from OpenAI API."</span>
    (<span class="org-keyword">let*</span> ((result nil)
           (auth-value (format <span class="org-string">"Bearer %s"</span> api-key))
           (chat-model (eq lc/gpt-model 'gpt-3.5-turbo-0301))
           (url (<span class="org-keyword">if</span> chat-model <span class="org-string">"https://api.openai.com/v1/chat/completions"</span> <span class="org-string">"https://api.openai.com/v1/completions"</span>))
           (prompt-key (<span class="org-keyword">if</span> chat-model <span class="org-string">"messages"</span> <span class="org-string">"prompt"</span>)))
      (request
        url
        <span class="org-builtin">:type</span> <span class="org-string">"POST"</span>
        <span class="org-builtin">:data</span> (json-encode `((,prompt-key . ,prompt-or-messages)
                             (<span class="org-string">"model"</span>  . ,lc/gpt-model)
                             <span class="org-comment-delimiter">;; </span><span class="org-comment">("max_tokens" . ,lc/gpt-max-output-tokens)</span>
                             <span class="org-comment-delimiter">;; </span><span class="org-comment">("temperature" . ,lc/gpt-temperature)</span>
                             <span class="org-comment-delimiter">;; </span><span class="org-comment">("frequency_penalty" . ,lc/gpt-frequency-penalty)</span>
                             <span class="org-comment-delimiter">;; </span><span class="org-comment">("presence_penalty" . ,lc/gpt-presence-penalty)</span>
                             <span class="org-comment-delimiter">;; </span><span class="org-comment">("top_p" . ,lc/gpt-top-p)</span>
                             ))
        <span class="org-builtin">:headers</span> `((<span class="org-string">"Authorization"</span> . ,auth-value) (<span class="org-string">"Content-Type"</span> . <span class="org-string">"application/json"</span>))
        <span class="org-builtin">:sync</span> t
        <span class="org-builtin">:parser</span> 'json-read
        <span class="org-builtin">:success</span> (<span class="org-keyword">cl-function</span>
                  (<span class="org-keyword">lambda</span> (<span class="org-type">&amp;key</span> data <span class="org-type">&amp;allow-other-keys</span>)
                    (<span class="org-keyword">setq</span> result (<span class="org-keyword">if</span> (eq lc/gpt-model 'gpt-3.5-turbo-0301)
                                     (alist-get 'content (alist-get 'message (elt (alist-get 'choices data) 0)))
                                   (alist-get 'text (elt (alist-get 'choices data) 0))))))
        <span class="org-builtin">:error</span> (<span class="org-keyword">cl-function</span> (<span class="org-keyword">lambda</span> (<span class="org-type">&amp;rest</span> args <span class="org-type">&amp;key</span> error-thrown <span class="org-type">&amp;allow-other-keys</span>)
                              (message <span class="org-string">"Got error: %S"</span> error-thrown))))
      result))

  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/gpt-complete-and-insert</span> (prompt)
    (<span class="org-keyword">let*</span> ((result (lc/gpt-complete-str (funcall lc/gpt-api-key-getter) prompt)))
      (goto-char (point-max))
      (<span class="org-keyword">if</span> result
          (<span class="org-keyword">progn</span>
            (insert <span class="org-string">"\n"</span> result)
            (fill-paragraph)
            result)
        (message <span class="org-string">"Empty result"</span>))))

  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/gpt-complete-with-prompt-prefix-and-insert</span> (start end)
    (<span class="org-keyword">interactive</span> <span class="org-string">"r"</span>)
    (<span class="org-keyword">let*</span> ((offset 100)
           (action (completing-read
                    <span class="org-string">"Select completion action: "</span>
                    (<span class="org-keyword">lambda</span> (string predicate action)
                      (<span class="org-keyword">if</span> (eq action 'metadata)
                          `(metadata
                            (display-sort-function . ,#'identity)
                            (annotation-function
                             . ,(<span class="org-keyword">lambda</span> (cand)
                                  (concat (propertize <span class="org-string">" "</span> 'display `((space <span class="org-builtin">:align-to</span> (- right ,offset))))
                                          (cdr (assoc cand lc/gpt-prompt-prefix-alist))))))
                        (complete-with-action action lc/gpt-prompt-prefix-alist string predicate)))
                    nil t))
           (instruction (cdr (assoc action lc/gpt-prompt-prefix-alist)))
           (text (string-trim (buffer-substring start end)))
           (prompt (concat instruction <span class="org-string">"\n"</span> text)))
      (lc/gpt-complete-and-insert prompt)))

  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/gpt-complete-region-and-insert</span> (start end)
    <span class="org-doc">"Send the region to OpenAI and insert the result to the end of buffer. "</span>
    (<span class="org-keyword">interactive</span> <span class="org-string">"r"</span>)
    (<span class="org-keyword">let*</span> ((prompt (buffer-substring-no-properties start end))
          (messages `[((<span class="org-string">"role"</span>    . <span class="org-string">"user"</span>) (<span class="org-string">"content"</span> . ,prompt))])
          (chat-model (eq lc/gpt-model 'gpt-3.5-turbo-0301)))
      (lc/gpt-complete-and-insert (<span class="org-keyword">if</span> chat-model messages prompt))))

    (<span class="org-keyword">defun</span> <span class="org-function-name">lc/gpt-complete-buffer-and-insert</span> ()
      <span class="org-doc">"Send the ENTIRE buffer, up to max tokens, to OpenAI and insert the result to the end of buffer."</span>
      (<span class="org-keyword">interactive</span>)
      (<span class="org-keyword">let</span> ((prompt (buffer-substring-no-properties (point-min) (point-max))))
        (lc/gpt-complete-and-insert prompt)))

    <span class="org-builtin">:config</span>
    (<span class="org-keyword">require</span> '<span class="org-constant">request</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-search-with-alpaca" class="outline-3">
<h3 id="search-with-alpaca">Search with alpaca</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">emacs</span>
  <span class="org-builtin">:bind</span>
  (<span class="org-string">"&lt;leader&gt;sa"</span> . 'search-with-alpaca)
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">defcustom</span> <span class="org-variable-name">alpaca-binary</span> <span class="org-string">"~/git/alpaca.cpp/chat"</span>
    <span class="org-doc">"Path to the alpaca.cpp compiled binary"</span>)

  (<span class="org-keyword">defcustom</span> <span class="org-variable-name">alpaca-model-path</span> <span class="org-string">"~/git/alpaca.cpp/ggml-alpaca-7b-q4.bin"</span>
    <span class="org-doc">"path to alpaca-models"</span>)

  (<span class="org-keyword">defcustom</span> <span class="org-variable-name">alpaca-args</span> '(<span class="org-string">"-t"</span> <span class="org-string">"8"</span>)
    <span class="org-doc">"Arguments to pass to alpaca"</span>)

  (<span class="org-keyword">defvar</span> <span class="org-variable-name">swl-current-process-buffer</span> nil <span class="org-doc">"Mini-buffer currently being used to display the process."</span>)

  (<span class="org-keyword">defvar</span> <span class="org-variable-name">swl-query-hist</span> nil)

  (<span class="org-keyword">defvar-local</span> <span class="org-variable-name">swl-process-state</span> nil <span class="org-doc">"State of the swl buffer."</span>)
  (<span class="org-keyword">defvar-local</span> <span class="org-variable-name">swl-process-start-point</span> nil <span class="org-doc">"Point at which query starts."</span>)
  (<span class="org-keyword">defvar-local</span> <span class="org-variable-name">swl-process-cmd</span> nil <span class="org-doc">"Original query command running in the buffer."</span>)

  (<span class="org-keyword">defvar</span> <span class="org-variable-name">swl-result-mode-map</span>
    (<span class="org-keyword">let</span> ((map (make-sparse-keymap)))
      (suppress-keymap map)
      (define-key map <span class="org-string">"q"</span> 'swl-quit)
      (define-key map <span class="org-string">"r"</span> 'swl-restart-query)
      map))

  (<span class="org-keyword">defun</span> <span class="org-function-name">swl-make-buffer-command</span> (command <span class="org-type">&amp;optional</span> full)
    <span class="org-doc">"Return a string that invokes alpaca.cpp with a query COMMAND and model MODEL."</span>
    (format <span class="org-string">"%s -p \"%s\" --model %s %s"</span>
              alpaca-binary
              command
              alpaca-model-path
              (string-join alpaca-args <span class="org-string">" "</span>)))

  (<span class="org-keyword">defun</span> <span class="org-function-name">swl-clear-running-process</span> ()
    (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> swl-current-process-buffer (buffer-live-p swl-current-process-buffer))
      (<span class="org-keyword">let</span>  ((process (get-buffer-process swl-current-process-buffer)))
        (<span class="org-keyword">if</span> process (kill-process process)))
      (<span class="org-keyword">with-current-buffer</span> swl-current-process-buffer
        (erase-buffer))))

  (<span class="org-keyword">defun</span> <span class="org-function-name">swl-quit</span> ()
    (<span class="org-keyword">interactive</span>)
    (swl-clear-running-process)
    (<span class="org-keyword">when</span> swl-current-process-buffer
      (<span class="org-keyword">with-current-buffer</span> swl-current-process-buffer
        (<span class="org-keyword">setq</span> swl-process-cmd nil)
        (<span class="org-keyword">setq</span> swl-process-state nil)))
    (quit-window))

  (<span class="org-keyword">defun</span> <span class="org-function-name">swl-run-query</span> (cmd)
    (<span class="org-keyword">if</span> swl-current-process-buffer
        (swl-clear-running-process))
    (<span class="org-keyword">with-current-buffer</span> swl-current-process-buffer
      (<span class="org-keyword">setq</span> swl-process-state nil)
      (<span class="org-keyword">setq</span> swl-process-cmd cmd)
      (goto-char 0)
      (insert <span class="org-string">"CMD: "</span>) (insert cmd) (insert <span class="org-string">"\n"</span>)
      (insert <span class="org-string">"Press r to re-run query and q to quit.\n"</span>)
      (goto-char (point-max))
      (<span class="org-keyword">setq</span> swl-process-start-point (make-marker))
      (move-marker swl-process-start-point (point))
      (use-local-map swl-result-mode-map))
    (<span class="org-keyword">let</span> (proc)
      (<span class="org-keyword">setq</span> proc (start-process-shell-command
                  <span class="org-string">"swl-search-process"</span>
                  swl-current-process-buffer
                  cmd))
      (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> proc (processp proc))
        (set-process-filter proc #'swl-filter))))

  (<span class="org-keyword">defun</span> <span class="org-function-name">swl-restart-query</span> ()
    (<span class="org-keyword">interactive</span>)
    (swl-clear-running-process)
    (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> swl-current-process-buffer (buffer-live-p swl-current-process-buffer))
      (<span class="org-keyword">with-current-buffer</span> swl-current-process-buffer
        (<span class="org-keyword">when</span> swl-process-cmd
          (swl-run-query swl-process-cmd)))))

  (<span class="org-keyword">defun</span> <span class="org-function-name">swl-filter</span> (process event)
    (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> swl-current-process-buffer (buffer-live-p swl-current-process-buffer) (process-live-p process))
      (<span class="org-keyword">with-current-buffer</span> swl-current-process-buffer
        (<span class="org-keyword">save-excursion</span>
          (goto-char (process-mark process))
          (insert event)
          (set-marker (process-mark process) (point))
          (<span class="org-keyword">unless</span> swl-process-state
            (goto-char (point-min))
            (<span class="org-keyword">setq</span> swl-process-state
                  (search-forward-regexp <span class="org-string">"sampling parameters:.*\n"</span> nil t))
            (<span class="org-keyword">if</span> swl-process-state
                (delete-region (marker-position swl-process-start-point) swl-process-state)))))))

  (<span class="org-keyword">defun</span> <span class="org-function-name">search-with-alpaca</span> (query <span class="org-type">&amp;optional</span> model-size model-type)
    (<span class="org-keyword">interactive</span>
     (list
      (completing-read <span class="org-string">""</span> swl-query-hist nil nil nil 'swl-query-hist)))
    (<span class="org-keyword">unless</span> (<span class="org-keyword">and</span> swl-current-process-buffer (buffer-live-p swl-current-process-buffer))
      (<span class="org-keyword">setq</span> swl-current-process-buffer (get-buffer-create <span class="org-string">"*swl-process-buffer*"</span>)))
    (<span class="org-keyword">let</span> (cmd)
      (<span class="org-keyword">setq</span> cmd (swl-make-buffer-command query))
      (swl-run-query cmd)
      (display-buffer-at-bottom swl-current-process-buffer '(previous-window))
      (pop-to-buffer swl-current-process-buffer)))
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-chatgpt-shell" class="outline-3">
<h3 id="chatgpt-shell">chatgpt-shell</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">chatgpt-shell</span>
  <span class="org-builtin">:vc</span> (<span class="org-builtin">:fetcher</span> <span class="org-string">"github"</span> <span class="org-builtin">:repo</span> <span class="org-string">"xenodium/chatgpt-shell"</span>)
  <span class="org-builtin">:bind</span>
  (<span class="org-string">"s-g"</span> . 'chatgpt-shell)
  (<span class="org-string">"s-d"</span> . 'dall-e-shell)
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> chatgpt-shell-openai-key (auth-source-pick-first-password <span class="org-builtin">:host</span> <span class="org-string">"chat.openai.com"</span>))
  (<span class="org-keyword">setq</span> chatgpt-shell-chatgpt-model-version <span class="org-string">"gpt-3.5-turbo-0301"</span>)
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-copilot" class="outline-3">
<h3 id="copilot">copilot</h3>
<div class="outline-text-3">
<p>
Notest:
</p>
<ul class="org-ul">
<li><a href="https://github.com/jimeh/.emacs.d/blob/master/modules/completion/siren-copilot.el">Reference</a></li>
<li><a href="https://github.com/zerolfx/copilot.el/issues/103">Keybindings</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">copilot</span>
  <span class="org-builtin">:vc</span> (<span class="org-builtin">:fetcher</span> <span class="org-string">"github"</span> <span class="org-builtin">:repo</span> <span class="org-string">"zerolfx/copilot.el"</span>)
  <span class="org-builtin">:hook</span>
  (prog-mode . (<span class="org-keyword">lambda</span> () (<span class="org-keyword">when</span> lc/copilot-enabled (copilot-mode))))
  <span class="org-builtin">:custom</span>
  (copilot-idle-delay 0)
  <span class="org-builtin">:bind</span>
  (<span class="org-string">"C-TAB"</span> . 'copilot-accept-completion-by-word)
  (<span class="org-string">"C-&lt;tab&gt;"</span> . 'copilot-accept-completion-by-word)
  (<span class="org-string">"&lt;leader&gt;cc"</span> . (<span class="org-keyword">lambda</span> () (<span class="org-keyword">interactive</span>)
             (<span class="org-keyword">setq</span> lc/copilot-enabled (<span class="org-keyword">if</span> lc/copilot-enabled nil t))
             (message (<span class="org-keyword">if</span> lc/copilot-enabled <span class="org-string">"Enabled copilot-mode"</span> <span class="org-string">"Disabled copilot-mode"</span>))
             (lc/toggle-copilot-mode)))
  (<span class="org-builtin">:map</span> copilot-completion-map
        (<span class="org-string">"&lt;tab&gt;"</span> . 'copilot-accept-completion)
        (<span class="org-string">"C-g"</span> . #'copilot-clear-overlay)
        (<span class="org-string">"C-n"</span> . #'copilot-next-completion)
        (<span class="org-string">"C-p"</span> . #'copilot-previous-completion))
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> lc/copilot-enabled nil)
  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/toggle-copilot-mode</span> ()
    (<span class="org-keyword">interactive</span>)
    (copilot-mode (<span class="org-keyword">if</span> lc/copilot-enabled 1 -1)))
  )
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-git" class="outline-2">
<h2 id="git">Git</h2>
<div class="outline-text-2" id="text-git">
</div>
<div id="outline-container-magit" class="outline-3">
<h3 id="magit">Magit</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">magit</span>
  <span class="org-builtin">:bind</span>
  ((<span class="org-string">"&lt;leader&gt;gb"</span> . 'magit-blame)
   (<span class="org-string">"&lt;leader&gt;gg"</span> . 'magit-status)
   (<span class="org-string">"&lt;leader&gt;gG"</span> . 'magit-status-here)
   (<span class="org-string">"&lt;leader&gt;gl"</span> . 'magit-log)
   (<span class="org-builtin">:map</span> magit-status-mode-map
         (<span class="org-string">"SPC"</span> . evil-send-leader)
         (<span class="org-string">"TAB"</span> . 'magit-section-toggle)
         (<span class="org-string">"ESC"</span> . 'transient-quit-one))
   (<span class="org-builtin">:map</span> magit-stash-mode-map
         (<span class="org-string">"TAB"</span> . 'magit-section-toggle)
         (<span class="org-string">"ESC"</span> . 'transient-quit-one))
   (<span class="org-builtin">:map</span> magit-revision-mode-map
         (<span class="org-string">"TAB"</span> . 'magit-section-toggle)
         (<span class="org-string">"ESC"</span> . 'transient-quit-one))
   (<span class="org-builtin">:map</span> magit-process-mode-map
         (<span class="org-string">"TAB"</span> . 'magit-section-toggle)
         (<span class="org-string">"ESC"</span> . 'transient-quit-one))
   (<span class="org-builtin">:map</span> magit-diff-mode-map
         (<span class="org-string">"TAB"</span> . 'magit-section-toggle)
         (<span class="org-string">"ESC"</span> . 'transient-quit-one))
   (<span class="org-builtin">:map</span> magit-mode-map
         (<span class="org-string">"&lt;normal-state&gt; zz"</span> . 'evil-scroll-line-to-center)
         (<span class="org-string">"&lt;visual-state&gt; zz"</span> . 'evil-scroll-line-to-center)))
  <span class="org-builtin">:custom</span>
  (magit-display-buffer-function #'magit-display-buffer-same-window-except-diff-v1)
  (magit-log-arguments '(<span class="org-string">"--graph"</span> <span class="org-string">"--decorate"</span> <span class="org-string">"--color"</span>))
  (git-commit-fill-column 72)
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">setq</span> magit-buffer-name-format (concat <span class="org-string">"*"</span> magit-buffer-name-format <span class="org-string">"*"</span>))
  <span class="org-comment-delimiter">;; </span><span class="org-comment">adding autostash suffix to magit-pull</span>
  (transient-append-suffix 'magit-pull <span class="org-string">"-A"</span>
    '(<span class="org-string">"-A"</span> <span class="org-string">"Autostash"</span> <span class="org-string">"--autostash"</span>)))
</pre>
</div>
</div>
</div>

<div id="outline-container-git-time-machine" class="outline-3">
<h3 id="git-time-machine">git time machine</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">git-timemachine</span>
  <span class="org-builtin">:hook</span>
  (git-time-machine-mode . evil-normalize-keymaps)
  <span class="org-builtin">:custom</span>
  (git-timemachine-show-minibuffer-details t)
  <span class="org-builtin">:bind</span>
  ((<span class="org-string">"&lt;leader&gt;gt"</span> . 'git-timemachine-toggle)
   (<span class="org-builtin">:map</span> git-timemachine-mode-map
         (<span class="org-string">"C-k"</span> . 'git-timemachine-show-previous-revision)
         (<span class="org-string">"C-j"</span> . 'git-timemachine-show-next-revision)
         (<span class="org-string">"q"</span> . 'git-timemachine-quit))))
</pre>
</div>
</div>
</div>

<div id="outline-container-diff-highlight" class="outline-3">
<h3 id="diff-highlight">diff highlight</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">diff-hl</span>
  <span class="org-builtin">:bind</span>
  (<span class="org-string">"&lt;leader&gt;gn"</span> . 'diff-hl-next-hunk)
  (<span class="org-string">"&lt;leader&gt;gp"</span> . 'diff-hl-previous-hunk)
  <span class="org-builtin">:hook</span>
  ((magit-pre-refresh . diff-hl-magit-pre-refresh)
   (magit-post-refresh . diff-hl-magit-post-refresh)
   (prog-mode org-mode))
  <span class="org-builtin">:custom</span>
  (diff-hl-draw-borders nil)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">(setq diff-hl-global-modes '(not org-mode))</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">(setq diff-hl-fringe-bmp-function 'diff-hl-fringe-bmp-from-type)</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">(setq diff-hl-global-modes (not '(image-mode org-mode)))</span>
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-smerge-hydra" class="outline-3">
<h3 id="smerge-hydra">smerge-hydra</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">hydra</span>
  <span class="org-builtin">:bind</span>
  (<span class="org-string">"&lt;leader&gt;gm"</span> . 'smerge-hydra/body)
  <span class="org-builtin">:hook</span>
  (magit-diff-visit-file . (<span class="org-keyword">lambda</span> () (<span class="org-keyword">when</span> smerge-mode (smerge-hydra/body))))
  <span class="org-builtin">:config</span>
  (defhydra smerge-hydra
    <span class="org-comment-delimiter">;; </span><span class="org-comment">Disable `</span><span class="org-comment"><span class="org-constant">smerge-mode</span></span><span class="org-comment">' when quitting hydra if no merge conflicts remain.</span>
    (<span class="org-builtin">:hint</span> nil <span class="org-builtin">:pre</span> (smerge-mode 1) <span class="org-builtin">:post</span> (smerge-auto-leave))
    <span class="org-string">"</span>
<span class="org-string">                                                    &#9581;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;</span>
<span class="org-string">  Movement   Keep           Diff              Other &#9474; smerge &#9474;</span>
<span class="org-string">  &#9581;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9524;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9583;</span>
<span class="org-string">     ^_g_^       [_b_] base       [_&lt;_] upper/base    [_C_] Combine</span>
<span class="org-string">     ^_C-k_^     [_u_] upper      [_=_] upper/lower   [_r_] resolve</span>
<span class="org-string">     ^_k_ &#8593;^     [_l_] lower      [_&gt;_] base/lower    [_R_] remove</span>
<span class="org-string">     ^_j_ &#8595;^     [_a_] all        [_H_] hightlight</span>
<span class="org-string">     ^_C-j_^     [_RET_] current  [_E_] ediff             &#9581;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;</span>
<span class="org-string">     ^_G_^                                            &#9474; [_q_] quit"</span>
    (<span class="org-string">"g"</span> (<span class="org-keyword">progn</span> (goto-char (point-min)) (smerge-next)))
    (<span class="org-string">"G"</span> (<span class="org-keyword">progn</span> (goto-char (point-max)) (smerge-prev)))
    (<span class="org-string">"C-j"</span> smerge-next)
    (<span class="org-string">"C-k"</span> smerge-prev)
    (<span class="org-string">"j"</span> next-line)
    (<span class="org-string">"k"</span> previous-line)
    (<span class="org-string">"b"</span> smerge-keep-base)
    (<span class="org-string">"u"</span> smerge-keep-upper)
    (<span class="org-string">"l"</span> smerge-keep-lower)
    (<span class="org-string">"a"</span> smerge-keep-all)
    (<span class="org-string">"RET"</span> smerge-keep-current)
    (<span class="org-string">"\C-m"</span> smerge-keep-current)
    (<span class="org-string">"&lt;"</span> smerge-diff-base-upper)
    (<span class="org-string">"="</span> smerge-diff-upper-lower)
    (<span class="org-string">"&gt;"</span> smerge-diff-base-lower)
    (<span class="org-string">"H"</span> smerge-refine)
    (<span class="org-string">"E"</span> smerge-ediff)
    (<span class="org-string">"C"</span> smerge-combine-with-next)
    (<span class="org-string">"r"</span> smerge-resolve)
    (<span class="org-string">"R"</span> smerge-kill-current)
    (<span class="org-string">"q"</span> nil <span class="org-builtin">:color</span> blue)))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org" class="outline-2">
<h2 id="org">Org</h2>
<div class="outline-text-2" id="text-org">
</div>
<div id="outline-container-org-mode" class="outline-3">
<h3 id="org-mode">Org mode</h3>
<div class="outline-text-3">
<p>
When exporting <code>.org</code> file to HTML, we can add this header:
</p>
<div class="org-src-container">
<pre class="src src-org"><span class="org-org-meta-line">#+HTML_HEAD: &lt;link rel="stylesheet" type="text/css" href="<a href="https://gongzhitaao.org/orgcss/org.css&quot;/">https://gongzhitaao.org/orgcss/org.css"/</a>&gt;</span>
</pre>
</div>

<p>
We can avoid evaluation of code with:
</p>
<blockquote>
</blockquote>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">org</span>
  <span class="org-builtin">:ensure</span> nil
  <span class="org-builtin">:bind</span>
  (<span class="org-builtin">:map</span> org-mode-map
        (<span class="org-string">"&lt;localleader&gt;a"</span> . 'org-archive-subtree)
        (<span class="org-string">"&lt;localleader&gt;i"</span> . 'org-insert-structure-template)
        (<span class="org-string">"&lt;visual-state&gt;&lt;localleader&gt;l"</span> . 'org-insert-link)
        (<span class="org-string">"&lt;normal-state&gt;&lt;localleader&gt;ll"</span> . 'org-insert-link)
        (<span class="org-string">"&lt;normal-state&gt;&lt;localleader&gt;ls"</span> . 'org-store-link)
        (<span class="org-string">"&lt;localleader&gt;L"</span> . (<span class="org-keyword">lambda</span> () (<span class="org-keyword">interactive</span>) (org-latex-preview)))
        (<span class="org-string">"&lt;localleader&gt;n"</span> . 'org-toggle-narrow-to-subtree)
        (<span class="org-string">"&lt;localleader&gt;r"</span> . 'org-refile)
        (<span class="org-string">"&lt;localleader&gt;x"</span> . 'org-toggle-checkbox)
        (<span class="org-string">"&lt;normal-state&gt;&lt;localleader&gt;el"</span> . 'eros-eval-last-sexp)
        (<span class="org-string">"&lt;visual-state&gt;&lt;localleader&gt;e"</span> . 'eros-eval-last-sexp)
        (<span class="org-string">"&lt;localleader&gt;E"</span> . 'org-export-dispatch)
        (<span class="org-string">"TAB"</span> . nil)
        )
  <span class="org-builtin">:custom</span>
  (org-src-preserve-indentation t)
  (org-src-tab-acts-natively t)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">(org-startup-indented t)</span>
  (org-hide-emphasis-markers t)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">(org-hide-leading-stars t)</span>
  (org-catch-invisible-edits 'smart)
  (org-pretty-entities t)
  (org-ellipsis <span class="org-string">"&#8230;"</span>)
  (org-insert-heading-respect-content t)
  (org-image-actual-width nil)
  <span class="org-builtin">:preface</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">+org-cycle-only-current-subtree-h</span> (<span class="org-type">&amp;optional</span> arg)
    <span class="org-doc">"Toggle the local fold at the point, and no deeper."</span>
    (<span class="org-keyword">interactive</span> <span class="org-string">"P"</span>)
    (<span class="org-keyword">unless</span> (eq this-command 'org-shifttab)
      (<span class="org-keyword">save-excursion</span>
        (org-beginning-of-line)
        (<span class="org-keyword">let</span> (invisible-p)
          (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> (org-at-heading-p)
                     (<span class="org-keyword">or</span> org-cycle-open-archived-trees
                         (not (member org-archive-tag (org-get-tags))))
                     (<span class="org-keyword">or</span> (not arg)
                         (<span class="org-keyword">setq</span> invisible-p (outline-invisible-p (line-end-position)))))
            (<span class="org-keyword">unless</span> invisible-p
              (<span class="org-keyword">setq</span> org-cycle-subtree-status 'subtree))
            (org-cycle-internal-local)
            t)))))
  <span class="org-builtin">:config</span>
  (remove-hook 'org-mode-hook 'org-appear-mode)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">(add-to-list 'org-src-lang-modes '("jupyter-python" . python-ts))</span>
  (plist-put org-format-latex-options <span class="org-builtin">:background</span> <span class="org-string">"Transparent"</span>)
  (plist-put org-format-latex-options <span class="org-builtin">:scale</span> 1.4)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Only fold the current tree, rather than recursively</span>
  (add-hook 'org-tab-first-hook #'+org-cycle-only-current-subtree-h)
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-use-org-id-in-links" class="outline-3">
<h3 id="use-org-id-in-links">use org-id in links</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">org</span>
  <span class="org-builtin">:preface</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/org-custom-id-get</span> (<span class="org-type">&amp;optional</span> pom create prefix)
    <span class="org-doc">"Get the CUSTOM_ID property of the entry at point-or-marker POM.</span>
<span class="org-doc">   If POM is nil, refer to the entry at point. If the entry does</span>
<span class="org-doc">   not have an CUSTOM_ID, the function returns nil. However, when</span>
<span class="org-doc">   CREATE is non nil, create a CUSTOM_ID if none is present</span>
<span class="org-doc">   already. PREFIX will be passed through to `</span><span class="org-doc"><span class="org-constant">org-id-new</span></span><span class="org-doc">'. In any</span>
<span class="org-doc">   case, the CUSTOM_ID of the entry is returned."</span>
    (<span class="org-keyword">interactive</span>)
    (<span class="org-keyword">org-with-point-at</span> pom
      (<span class="org-keyword">let</span> ((id (org-entry-get nil <span class="org-string">"CUSTOM_ID"</span>)))
        (<span class="org-keyword">cond</span>
         ((<span class="org-keyword">and</span> id (stringp id) (string-match <span class="org-string">"\\S-"</span> id))
          id)
         (create
          (<span class="org-keyword">setq</span> id (org-id-new (concat prefix <span class="org-string">"h"</span>)))
          (org-entry-put pom <span class="org-string">"CUSTOM_ID"</span> id)
          (org-id-add-location id (buffer-file-name (buffer-base-buffer)))
          id)))))
  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/org-add-ids-to-headlines-in-file</span> ()
    <span class="org-doc">"Add CUSTOM_ID properties to all headlines in the current</span>
<span class="org-doc">   file which do not already have one. Only adds ids if the</span>
<span class="org-doc">   `</span><span class="org-doc"><span class="org-constant">auto-id</span></span><span class="org-doc">' option is set to `</span><span class="org-doc"><span class="org-constant">t</span></span><span class="org-doc">' in the file somewhere. ie,</span>
<span class="org-doc">   #+OPTIONS: auto-id:t"</span>
    (<span class="org-keyword">interactive</span>)
    (<span class="org-keyword">save-excursion</span>
      (widen)
      (goto-char (point-min))
      (<span class="org-keyword">when</span> (re-search-forward <span class="org-string">"^#\\+OPTIONS:.*auto-id:t"</span> 10000 t)
        (org-map-entries (<span class="org-keyword">lambda</span> () (lc/org-custom-id-get (point) 'create))))))
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">require</span> '<span class="org-constant">org-id</span>)
  (<span class="org-keyword">setq</span> org-id-track-globally nil)
  (<span class="org-keyword">setq</span> org-id-link-to-org-use-id 'create-if-interactive-and-no-custom-id)
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-org-agenda-and-capture" class="outline-3">
<h3 id="org-agenda-and-capture">org agenda and capture</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">org</span>
  <span class="org-builtin">:bind</span>
  (<span class="org-string">"&lt;leader&gt;oa"</span> . 'org-agenda-list)
  (<span class="org-string">"&lt;leader&gt;oA"</span> . 'org-agenda)
  (<span class="org-string">"&lt;leader&gt;ot"</span> . 'org-todo-list)
  (<span class="org-string">"&lt;leader&gt;oC"</span> . 'org-capture)
  (<span class="org-string">"&lt;leader&gt;on"</span> . (<span class="org-keyword">lambda</span> () (<span class="org-keyword">interactive</span>) (org-agenda nil <span class="org-string">"n"</span>)))
  <span class="org-builtin">:custom</span>
  (org-agenda-custom-commands
   '((<span class="org-string">"n"</span> <span class="org-string">"Next Tasks"</span>
      ((todo <span class="org-string">"NEXT"</span>
             ((org-agenda-overriding-header <span class="org-string">"Next Tasks"</span>)))))
     (<span class="org-string">"w"</span> <span class="org-string">"Work Tasks"</span> tags-todo <span class="org-string">"+work"</span>)))
  (org-capture-templates
   `((<span class="org-string">"i"</span> <span class="org-string">"Inbox"</span> entry
      (file+headline <span class="org-string">"todo.org"</span> <span class="org-string">"Inbox"</span>)
      ,(concat <span class="org-string">"* %^{Title}\n"</span>
               <span class="org-string">":PROPERTIES:\n"</span>
               <span class="org-string">":CAPTURED: %U\n"</span>
               <span class="org-string">":END:\n\n"</span>
               <span class="org-string">"%i%l"</span>))
     (<span class="org-string">"w"</span> <span class="org-string">"Work"</span> entry
      (file+headline <span class="org-string">"todo.org"</span> <span class="org-string">"Work"</span>)
      ,(concat <span class="org-string">"* TODO [#A] %^{Title} :@work:\n"</span>
               <span class="org-string">"SCHEDULED: %^t\n"</span>
               <span class="org-string">":PROPERTIES:\n:CAPTURED: %U\n:END:\n\n"</span>
               <span class="org-string">"%i%?"</span>))))
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-org-babel" class="outline-3">
<h3 id="org-babel">Org babel</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">org</span>
  <span class="org-builtin">:bind</span>
  (<span class="org-builtin">:map</span> org-mode-map
        (<span class="org-string">"&lt;localleader&gt;."</span> . 'org-edit-special)
        (<span class="org-string">"&lt;localleader&gt;,"</span> . 'org-ctrl-c-ctrl-c)
        (<span class="org-string">"&lt;localleader&gt;-"</span> . 'org-babel-demarcate-block)
        (<span class="org-string">"&lt;localleader&gt;z"</span> . 'org-babel-hide-result-toggle))
  (<span class="org-builtin">:map</span> org-src-mode-map
        (<span class="org-string">"&lt;localleader&gt;."</span> . 'org-edit-src-exit))
  <span class="org-comment-delimiter">;; </span><span class="org-comment">:hook</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">((prog-mode org-mode) . (lambda () (setq indent-line-function #'(lambda () 'noindent))))</span>
  <span class="org-builtin">:custom</span>
  (org-confirm-babel-evaluate nil)
  (org-src-ask-before-returning-to-edit-buffer nil)
  (org-src-window-setup 'current-window)
  <span class="org-builtin">:config</span>
  (org-babel-do-load-languages
   'org-babel-load-languages
   '((emacs-lisp . t)
     <span class="org-comment-delimiter">;; </span><span class="org-comment">(clojure . t)</span>
     <span class="org-comment-delimiter">;; </span><span class="org-comment">(ledger . t)</span>
     (shell . t)))
  (add-hook 'org-babel-after-execute-hook 'org-display-inline-images 'append)
  )

<span class="org-comment-delimiter">;; </span><span class="org-comment">(use-package ob-async</span>
<span class="org-comment-delimiter">;;   </span><span class="org-comment">:hook (org-load . (lambda () (require 'ob-async)))</span>
<span class="org-comment-delimiter">;;   </span><span class="org-comment">:custom</span>
<span class="org-comment-delimiter">;;   </span><span class="org-comment">(ob-async-no-async-languages-alist '("jupyter-python" "jupyter-R" "jupyter-julia")))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org-modern" class="outline-3">
<h3 id="org-modern">org modern</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">org-modern</span>
  <span class="org-builtin">:hook</span>
  (org-mode . org-modern-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-org-export-config-to-html" class="outline-3">
<h3 id="org-export-config-to-html"><span class="todo TODO">TODO</span> org export config to HTML</h3>
<div class="outline-text-3">
<p>
Notes:
</p>
<ul class="org-ul">
<li>Github pages is set up on my config repo
<ul class="org-ul">
<li>Every time I push to <code>main</code> the HTML files get deployed to e.g. <code>https://lucacambiaghi.com/crafted-emacs-config/readme.html</code></li>
</ul></li>
<li>To export:
<ul class="org-ul">
<li>Restart emacs and run <code>org-export-dispatch</code></li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">org-html-themify</span>
  <span class="org-builtin">:vc</span> (<span class="org-builtin">:fetcher</span> <span class="org-string">"github"</span> <span class="org-builtin">:repo</span> <span class="org-string">"DogLooksGood/org-html-themify"</span>)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">:hook (org-mode . org-html-themify-mode)</span>
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">use-package</span> <span class="org-constant">hexrgb</span>
    <span class="org-builtin">:vc</span> (<span class="org-builtin">:fetcher</span> <span class="org-string">"github"</span> <span class="org-builtin">:repo</span> <span class="org-string">"emacsmirror/hexrgb"</span>)
    <span class="org-builtin">:demand</span> t)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">otherwise it complains about invalid face</span>
  (<span class="org-keyword">require</span> '<span class="org-constant">hl-line</span>)
  (<span class="org-keyword">setq</span> org-html-themify-themes
        '((light . modus-operandi)
          (dark . modus-operandi)))
  (<span class="org-keyword">setq</span> org-export-backends '(html)))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-other-packages" class="outline-2">
<h2 id="other-packages">Other packages</h2>
<div class="outline-text-2" id="text-other-packages">
</div>
<div id="outline-container-bookmark" class="outline-3">
<h3 id="bookmark"><span class="todo TODO">TODO</span> bookmark</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">bookmark</span>
  <span class="org-builtin">:ensure</span> nil
  <span class="org-builtin">:bind</span>
  (<span class="org-string">"&lt;leader&gt;rr"</span> . 'bookmark-set)
  (<span class="org-string">"&lt;leader&gt;rd"</span> . 'bookmark-delete)
  (<span class="org-string">"&lt;leader&gt;r1"</span> . (<span class="org-keyword">lambda</span> () (<span class="org-keyword">interactive</span>) (bookmark-set <span class="org-string">"1"</span>)))
  (<span class="org-string">"&lt;leader&gt;r2"</span> . (<span class="org-keyword">lambda</span> () (<span class="org-keyword">interactive</span>) (bookmark-set <span class="org-string">"2"</span>)))
  (<span class="org-string">"&lt;leader&gt;r3"</span> . (<span class="org-keyword">lambda</span> () (<span class="org-keyword">interactive</span>) (bookmark-set <span class="org-string">"3"</span>)))
  (<span class="org-string">"&lt;leader&gt;r4"</span> . (<span class="org-keyword">lambda</span> () (<span class="org-keyword">interactive</span>) (bookmark-set <span class="org-string">"4"</span>)))
  (<span class="org-string">"s-1"</span> . (<span class="org-keyword">lambda</span> () (<span class="org-keyword">interactive</span>) (bookmark-jump <span class="org-string">"1"</span>)))
  (<span class="org-string">"s-2"</span> . (<span class="org-keyword">lambda</span> () (<span class="org-keyword">interactive</span>) (bookmark-jump <span class="org-string">"2"</span>)))
  (<span class="org-string">"s-3"</span> . (<span class="org-keyword">lambda</span> () (<span class="org-keyword">interactive</span>) (bookmark-jump <span class="org-string">"3"</span>)))
  (<span class="org-string">"s-4"</span> . (<span class="org-keyword">lambda</span> () (<span class="org-keyword">interactive</span>) (bookmark-jump <span class="org-string">"4"</span>)))
  <span class="org-comment-delimiter">;; </span><span class="org-comment">("s-1" . (lambda () (interactive) (jump-to-numbered-bookmark 0)))</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">("s-2" . (lambda () (interactive) (jump-to-numbered-bookmark 1)))</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">("s-3" . (lambda () (interactive) (jump-to-numbered-bookmark 2)))</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">("s-4" . (lambda () (interactive) (jump-to-numbered-bookmark 3)))</span>
  <span class="org-builtin">:preface</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">jump-to-numbered-bookmark</span> (num)
    <span class="org-doc">"Jump to the bookmark with the given numeric prefix."</span>
    (<span class="org-keyword">interactive</span>)
    (<span class="org-keyword">when-let</span> ((bookmark (nth num bookmark-alist)))
      (find-file (bookmark-get-filename bookmark))))
  <span class="org-comment-delimiter">;; </span><span class="org-comment">:config</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">(add-hook 'bookmark-bmenu-mode-hook #'hl-line-mode)</span>
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-consult" class="outline-3">
<h3 id="consult">consult</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">consult</span>
  <span class="org-builtin">:bind</span>
  (<span class="org-string">"&lt;leader&gt;bb"</span> . 'consult-buffer)
  (<span class="org-string">"&lt;leader&gt;fr"</span> . 'consult-recent-file)
  (<span class="org-string">"&lt;leader&gt;rr"</span> . 'consult-bookmark)
  (<span class="org-string">"&lt;leader&gt;so"</span> . 'consult-outline)
  (<span class="org-string">"&lt;leader&gt;ss"</span> . 'consult-line)
  (<span class="org-string">"&lt;leader&gt;sS"</span> . 'lc/search-symbol-at-point)
  (<span class="org-string">"&lt;leader&gt;sp"</span> . 'consult-ripgrep)
  (<span class="org-string">"&lt;leader&gt;sd"</span> . 'lc/consult-ripgrep-at-point)
  (<span class="org-string">"C-p"</span> . 'consult-yank-pop)
  (<span class="org-string">"&lt;insert-state&gt;C-p"</span> . 'consult-yank-pop)
  (<span class="org-string">"M-p"</span> . 'consult-toggle-preview)
  <span class="org-builtin">:preface</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/search-symbol-at-point</span> ()
    <span class="org-doc">"Performs a search in the current buffer for thing at point."</span>
    (<span class="org-keyword">interactive</span>)
    (consult-line (thing-at-point 'symbol)))
  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/consult-ripgrep-at-point</span> (<span class="org-type">&amp;optional</span> dir initial)
    (<span class="org-keyword">interactive</span>
     (list
      (read-directory-name <span class="org-string">"Directory:"</span>)
      (<span class="org-keyword">when-let</span> ((s (symbol-at-point)))
        (symbol-name s))))
    (consult-ripgrep dir initial))
  <span class="org-builtin">:config</span>
  (consult-customize
   consult-ripgrep consult-git-grep consult-grep
   consult-bookmark consult-recent-file consult-xref
   consult--source-bookmark consult--source-file-register
   consult--source-recent-file consult--source-project-recent-file
   <span class="org-comment-delimiter">;; </span><span class="org-comment">my/command-wrapping-consult    ;; disable auto previews inside my command</span>
   <span class="org-builtin">:preview-key</span> '(<span class="org-builtin">:debounce</span> 1 any) <span class="org-comment-delimiter">;; </span><span class="org-comment">Option 1: Delay preview</span>
   <span class="org-comment-delimiter">;; </span><span class="org-comment">:preview-key "M-."            ;; Option 2: Manual preview</span>
   ))
</pre>
</div>
</div>
</div>

<div id="outline-container-consult-notes" class="outline-3">
<h3 id="consult-notes">consult-notes</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">consult-notes</span>
  <span class="org-builtin">:bind</span>
  (<span class="org-string">"&lt;leader&gt;sn"</span> . 'consult-notes)
  (<span class="org-string">"&lt;leader&gt;sN"</span> . 'consult-notes-search-in-all-notes)
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">when</span> (locate-library <span class="org-string">"denote"</span>)
    (consult-notes-denote-mode)))
</pre>
</div>
</div>
</div>

<div id="outline-container-corfu" class="outline-3">
<h3 id="corfu"><span class="todo TODO">TODO</span> corfu</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">corfu</span>
  <span class="org-builtin">:bind</span>
  (<span class="org-builtin">:map</span> corfu-map
        (<span class="org-string">"&lt;insert-state&gt;&lt;escape&gt;"</span> . 'corfu-quit))
  <span class="org-builtin">:custom</span>
  (corfu-min-width 80)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Always have the same width</span>
  (corfu-max-width corfu-min-width)
  (corfu-auto nil)
  (tab-always-indent 'complete)
  <span class="org-builtin">:config</span>
  (corfu-popupinfo-mode -1)
  (global-corfu-mode -1)
)
</pre>
</div>
</div>
</div>

<div id="outline-container-denote" class="outline-3">
<h3 id="denote">denote</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">denote</span>
  <span class="org-builtin">:hook</span>
  (dired-mode . denote-dired-mode)
  <span class="org-builtin">:bind</span>
  (<span class="org-string">"&lt;leader&gt;nn"</span> . 'denote-open-or-create)
  (<span class="org-string">"&lt;leader&gt;nk"</span> . 'denote-keywords-add)
  (<span class="org-string">"&lt;leader&gt;nK"</span> . 'denote-keywords-remove)
  (<span class="org-string">"&lt;leader&gt;nr"</span> . 'denote-rename-file)
  (<span class="org-string">"&lt;leader&gt;nl"</span> . 'denote-link)
  (<span class="org-string">"&lt;leader&gt;nb"</span> . 'denote-link-backlinks)
  (<span class="org-string">"&lt;leader&gt;nj"</span> . 'lc/denote-journal)
  (<span class="org-string">"&lt;leader&gt;nt"</span> . (<span class="org-keyword">lambda</span> () (<span class="org-keyword">interactive</span>)
                    (tabspaces-switch-or-create-workspace <span class="org-string">"denote"</span>)
                    (find-file (concat denote-directory <span class="org-string">"/todo.org"</span>))))
  <span class="org-builtin">:custom</span>
  (denote-known-keywords '())
  (lc/gpt-prompts-file (concat denote-directory <span class="org-string">"/20230330T145824--useful-gpt-prompts__llm_org.org"</span>))
  <span class="org-builtin">:preface</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/denote-org-extract-subtree</span> ()
    <span class="org-doc">"Create new Denote note using current Org subtree. Delete the original subtree."</span>
    (<span class="org-keyword">interactive</span>)
    (<span class="org-keyword">if-let</span> ((text (org-get-entry))
             (heading (org-get-heading <span class="org-builtin">:no-tags</span> <span class="org-builtin">:no-todo</span> <span class="org-builtin">:no-priority</span> <span class="org-builtin">:no-comment</span>)))
        (<span class="org-keyword">progn</span>
          (delete-region (org-entry-beginning-position) (org-entry-end-position))
          (denote heading (org-get-tags) 'org)
          (insert text))
      (<span class="org-warning">user-error</span> <span class="org-string">"No subtree to extract; aborting"</span>)))
  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/denote-journal</span> ()
    <span class="org-doc">"Create an entry tagged '</span><span class="org-doc"><span class="org-constant">journal</span></span><span class="org-doc">' with the date as its title."</span>
    (<span class="org-keyword">interactive</span>)
    (denote
     (format-time-string <span class="org-string">"%A %e %B %Y"</span>) <span class="org-comment-delimiter">; </span><span class="org-comment">format like Tuesday 14 June 2022</span>
     '(<span class="org-string">"journal"</span>))) <span class="org-comment-delimiter">; </span><span class="org-comment">multiple keywords are a list of strings: '("one" "two")</span>
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> denote-directory <span class="org-string">"/Users/cambiaghiluca/OneDrive - The Boston Consulting Group, Inc/Documents/denote"</span>)

  (<span class="org-keyword">with-eval-after-load</span> 'org
    (<span class="org-keyword">setq</span> org-directory denote-directory)
    (<span class="org-keyword">setq</span> org-agenda-files (directory-files-recursively denote-directory <span class="org-string">"\\.org$"</span>)))
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-denote-menu" class="outline-3">
<h3 id="denote-menu">denote menu</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">denote-menu</span>
  <span class="org-builtin">:commands</span>
  (list-denotes)
  <span class="org-builtin">:bind</span>
  (<span class="org-string">"&lt;leader&gt;nm"</span> . (<span class="org-keyword">lambda</span> () (<span class="org-keyword">interactive</span>)
                    (tabspaces-switch-or-create-workspace <span class="org-string">"denote"</span>) (list-denotes)))
  (<span class="org-string">"&lt;leader&gt;nf"</span> . 'denote-menu-filter-by-keyword)
  (<span class="org-string">"&lt;leader&gt;nF"</span> . 'denote-menu-clear-filters)
  (<span class="org-string">"&lt;leader&gt;nE"</span> . 'denote-menu-export-to-dired))
</pre>
</div>
</div>
</div>

<div id="outline-container-dired-and-extensions" class="outline-3">
<h3 id="dired-and-extensions">dired and extensions</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">dired</span>
  <span class="org-builtin">:ensure</span> nil
  <span class="org-builtin">:bind</span>
  (<span class="org-string">"&lt;leader&gt;fd"</span> . 'dired)
  (<span class="org-string">"&lt;leader&gt;fj"</span> . 'dired-jump)
  <span class="org-builtin">:hook</span>
  (dired-mode . dired-hide-details-mode)
  <span class="org-builtin">:custom</span>
  (dired-listing-switches <span class="org-string">"-lah"</span>)
  (dired-kill-when-opening-new-dired-buffer t)
  (dired-dwim-target t)
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/open-in-finder</span> ()
    (<span class="org-keyword">interactive</span>)
    (<span class="org-keyword">let</span> ((fn (dired-get-file-for-visit)))
      (start-process <span class="org-string">"open-directory"</span> nil <span class="org-string">"open"</span> <span class="org-string">"-R"</span> fn)))
  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/dired-open-externally</span> ()
    (<span class="org-keyword">interactive</span>)
    (<span class="org-keyword">let</span> ((fn (dired-get-file-for-visit)))
      (start-process <span class="org-string">"open-external"</span> nil <span class="org-string">"open"</span> fn)))
  <span class="org-builtin">:config</span>
  (define-key dired-mode-map (kbd <span class="org-string">"&lt;normal-state&gt;i"</span>) nil)
  (define-key dired-mode-map (kbd <span class="org-string">"&lt;normal-state&gt;X"</span>) nil)
  (evil-collection-define-key 'normal 'dired-mode-map
    <span class="org-string">"X"</span> 'lc/dired-open-externally
    <span class="org-string">"F"</span> 'lc/open-in-finder))

(<span class="org-keyword">use-package</span> <span class="org-constant">dired-hide-dotfiles</span>
  <span class="org-builtin">:hook</span>
  (dired-mode . dired-hide-dotfiles-mode)
  <span class="org-builtin">:config</span>
  (evil-collection-define-key 'normal 'dired-mode-map
    <span class="org-string">"H"</span> 'dired-hide-dotfiles-mode))

(<span class="org-keyword">use-package</span> <span class="org-constant">dired-subtree</span>
  <span class="org-builtin">:init</span>
  (advice-add 'dired-subtree-toggle
              <span class="org-builtin">:after</span> (<span class="org-keyword">lambda</span> () (<span class="org-keyword">interactive</span>)
                       (<span class="org-keyword">when</span> all-the-icons-dired-mode (revert-buffer))))
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">with-eval-after-load</span> 'evil
    (evil-collection-define-key 'normal 'dired-mode-map
      <span class="org-string">"i"</span> 'dired-subtree-toggle)))

(<span class="org-keyword">use-package</span> <span class="org-constant">all-the-icons-dired</span>
  <span class="org-builtin">:if</span> (display-graphic-p)
  <span class="org-builtin">:hook</span>
  (dired-mode . (<span class="org-keyword">lambda</span> () (<span class="org-keyword">interactive</span>)
                  (<span class="org-keyword">unless</span> (file-remote-p default-directory)
                    (all-the-icons-dired-mode)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-embark" class="outline-3">
<h3 id="embark">embark</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">embark</span>
  <span class="org-builtin">:bind</span>
  (<span class="org-string">"C-l"</span> . 'embark-act)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">(:keymaps 'embark-file-map</span>
  <span class="org-comment-delimiter">;;           </span><span class="org-comment">;; "o" 'find-file-other-window</span>
  <span class="org-comment-delimiter">;;           </span><span class="org-comment">"x" 'lc/dired-open-externally)</span>
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-eros" class="outline-3">
<h3 id="eros">eros</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">eros</span>
  <span class="org-builtin">:commands</span>
  (eros-eval-region eros-eval-last-sexp)
  <span class="org-builtin">:hook</span>
  (emacs-lisp-mode org-mode lisp-interaction-mode)
  <span class="org-builtin">:preface</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">eros-eval-region</span> (start end)
    (<span class="org-keyword">interactive</span> <span class="org-string">"r"</span>)
    (eros--eval-overlay
     (string-trim
      (<span class="org-keyword">with-output-to-string</span>
        (eval-region start end standard-output)))
     (max (point) (mark))))
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-flymake" class="outline-3">
<h3 id="flymake">flymake</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">flymake</span>
  <span class="org-builtin">:ensure</span> nil
  <span class="org-builtin">:hook</span> (((python-base-mode emacs-lisp-mode) . flymake-mode)
         <span class="org-comment-delimiter">;; </span><span class="org-comment">(lsp-managed-mode . (lambda () (cond ((derived-mode-p 'python-base-mode)</span>
         <span class="org-comment-delimiter">;;                                       </span><span class="org-comment">(add-hook 'flymake-diagnostic-functions 'python-flymake nil t))</span>
         <span class="org-comment-delimiter">;;                                      </span><span class="org-comment">;; if not adding diagnostic functions to other modes just use an if</span>
         <span class="org-comment-delimiter">;;                                      </span><span class="org-comment">;; ...</span>
         <span class="org-comment-delimiter">;;                                      </span><span class="org-comment">(t nil))))</span>
         )
<span class="org-builtin">:custom</span>
(flymake-fringe-indicator-position 'right-fringe)
<span class="org-comment-delimiter">;; </span><span class="org-comment">(python-flymake-command '("ruff" "--quiet" "--stdin-filename=stdin" "-"))</span>
                        <span class="org-comment-delimiter">;; </span><span class="org-comment">:general</span>
                        <span class="org-comment-delimiter">;; </span><span class="org-comment">(general-nmap "] !" 'flymake-goto-next-error)</span>
                        <span class="org-comment-delimiter">;; </span><span class="org-comment">(general-nmap "[ !" 'flymake-goto-prev-error)</span>
)
</pre>
</div>
</div>
</div>

<div id="outline-container-hydra-and-windows-hydra" class="outline-3">
<h3 id="hydra-and-windows-hydra">hydra and windows-hydra</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">hydra</span>
  <span class="org-builtin">:after</span> evil
  <span class="org-builtin">:bind</span>
  (<span class="org-string">"&lt;leader&gt;ww"</span> . 'evil-windows-hydra/body)
  <span class="org-builtin">:config</span>
  (defhydra evil-windows-hydra (<span class="org-builtin">:hint</span> nil
                                      <span class="org-comment-delimiter">;; </span><span class="org-comment">:pre (smerge-mode 1)</span>
                                      <span class="org-comment-delimiter">;; </span><span class="org-comment">:post (smerge-auto-leave)</span>
                                      )
    <span class="org-string">"</span>
<span class="org-string"> [_h_] &#8674;&#8672; decrease width [_l_] &#8672;&#8674; increase width</span>
<span class="org-string"> [_j_] decrease height [_k_] increase height</span>
<span class="org-string">&#9474; [_q_] quit"</span>
    (<span class="org-string">"h"</span> evil-window-decrease-width)
    (<span class="org-string">"l"</span> evil-window-increase-width)
    (<span class="org-string">"j"</span> evil-window-decrease-height)
    (<span class="org-string">"k"</span> evil-window-increase-height)
    (<span class="org-string">"q"</span> nil <span class="org-builtin">:color</span> blue)))
</pre>
</div>
</div>
</div>

<div id="outline-container-persistent-scratch" class="outline-3">
<h3 id="persistent-scratch">persistent scratch</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">persistent-scratch</span>
  <span class="org-builtin">:bind</span>
  (<span class="org-string">"&lt;leader&gt;bs"</span> . (<span class="org-keyword">lambda</span> ()
                    <span class="org-doc">"Load persistent-scratch if not already loaded"</span>
                    (<span class="org-keyword">interactive</span>)
                    (<span class="org-keyword">progn</span>
                      (<span class="org-keyword">unless</span> (boundp 'persistent-scratch-mode)
                        (<span class="org-keyword">require</span> '<span class="org-constant">persistent-scratch</span>))
                      (pop-to-buffer <span class="org-string">"*scratch*"</span>))))
  <span class="org-builtin">:custom</span>
  (persistent-scratch-autosave-interval 60)
  <span class="org-builtin">:config</span>
  (persistent-scratch-setup-default))
</pre>
</div>
</div>
</div>

<div id="outline-container-project" class="outline-3">
<h3 id="project">project</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">project</span>
  <span class="org-builtin">:ensure</span> nil
  <span class="org-builtin">:bind</span>
  (<span class="org-string">"&lt;leader&gt;pf"</span> . 'project-find-file)
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> project-vc-extra-root-markers '(<span class="org-string">"pyrpoject.toml"</span> <span class="org-string">".project"</span>))
  (<span class="org-keyword">setq</span> project-vc-ignores '(<span class="org-string">".idea"</span> <span class="org-string">".vscode"</span> <span class="org-string">".direnv"</span>))
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-rainbow-parentheses" class="outline-3">
<h3 id="rainbow-parentheses">Rainbow parentheses</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">rainbow-delimiters</span>
  <span class="org-builtin">:hook</span>
  (emacs-lisp-mode clojure-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-tempel" class="outline-3">
<h3 id="tempel">tempel</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">tempel</span>
  <span class="org-builtin">:custom</span>
  (tempel-trigger-prefix <span class="org-string">"&lt;"</span>)
  (tempel-path (concat user-config-directory <span class="org-string">"/templates.eld"</span>))
  <span class="org-builtin">:hook</span>
  ((prog-mode org-mode) . tempel-setup-capf)
  <span class="org-builtin">:preface</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Setup completion at point</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">tempel-setup-capf</span> ()
    (<span class="org-keyword">setq-local</span> completion-at-point-functions
                (cons #'tempel-complete
                      completion-at-point-functions)))
  <span class="org-comment-delimiter">;; </span><span class="org-comment">:init</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">(tempel-key "C-c t f" fun emacs-lisp-mode-map)</span>
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-transpose-frame" class="outline-3">
<h3 id="transpose-frame">Transpose frame</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">transpose-frame</span>
  <span class="org-builtin">:bind</span>
  (<span class="org-string">"&lt;leader&gt;wt"</span> . 'transpose-frame)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">flip</span>
  (<span class="org-string">"&lt;leader&gt;wf"</span> . 'rotate-frame))
</pre>
</div>
</div>
</div>

<div id="outline-container-tabspaces" class="outline-3">
<h3 id="tabspaces">tabspaces</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">tabspaces</span>
  <span class="org-builtin">:commands</span>
  (tabspaces-switch-or-create-workspace)
  <span class="org-builtin">:bind</span>
  (<span class="org-string">"&lt;leader&gt;pp"</span> . 'tabspaces-open-or-create-project-and-workspace)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">add new project to list</span>
  (<span class="org-string">"&lt;leader&gt;TAB n"</span> . 'tabspaces-project-switch-project-open-file)
  (<span class="org-string">"&lt;leader&gt;TAB TAB"</span> . 'tabspaces-switch-or-create-workspace)
  (<span class="org-string">"&lt;leader&gt;TAB d"</span> . 'tabspaces-kill-buffers-close-workspace)
  (<span class="org-string">"&lt;leader&gt;TAB h"</span> . 'tab-bar-switch-to-prev-tab)
  (<span class="org-string">"&lt;leader&gt;TAB l"</span> . 'tab-bar-switch-to-next-tab)
  (<span class="org-string">"&lt;leader&gt;oc"</span> . (<span class="org-keyword">lambda</span> () (<span class="org-keyword">interactive</span>)
                         (tabspaces-switch-or-create-workspace <span class="org-string">"crafted-emacs"</span>)
                         (find-file (concat user-config-directory <span class="org-string">"/readme.org"</span>))))
  <span class="org-builtin">:custom</span>
  (tabspaces-use-filtered-buffers-as-default t)
  (tabspaces-default-tab <span class="org-string">"Default"</span>)
  (tabspaces-remove-to-default t)
  (tabspaces-include-buffers '(<span class="org-string">"*scratch*"</span>))
  <span class="org-comment-delimiter">;; </span><span class="org-comment">sessions</span>
  (tabspaces-session t)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">(tabspaces-session-auto-restore t)</span>
  <span class="org-builtin">:preface</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/setup-tabspaces</span> ()
    <span class="org-doc">"Set up tabspace at startup."</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">Add *Messages* and *splash* to Tab \`Home\'</span>
    (tabspaces-mode 1)
    (<span class="org-keyword">progn</span>
      (tab-bar-rename-tab <span class="org-string">"Home"</span>)
      (<span class="org-keyword">when</span> (get-buffer <span class="org-string">"*Messages*"</span>)
        (set-frame-parameter nil
                             'buffer-list
                             (cons (get-buffer <span class="org-string">"*Messages*"</span>) (frame-parameter nil 'buffer-list))))))
  <span class="org-builtin">:config</span>
  (lc/setup-tabspaces)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Filter Buffers for Consult-Buffer</span>
  (<span class="org-keyword">with-eval-after-load</span> 'consult
    <span class="org-comment-delimiter">;; </span><span class="org-comment">hide full buffer list (still available with "b" prefix)</span>
    (consult-customize consult--source-buffer <span class="org-builtin">:hidden</span> t <span class="org-builtin">:default</span> nil)
    <span class="org-comment-delimiter">;; </span><span class="org-comment">set consult-workspace buffer list</span>
    (<span class="org-keyword">defvar</span> <span class="org-variable-name">consult--source-workspace</span>
      (list <span class="org-builtin">:name</span>     <span class="org-string">"Workspace Buffers"</span>
            <span class="org-builtin">:narrow</span>   ?w
            <span class="org-builtin">:history</span>  'buffer-name-history
            <span class="org-builtin">:category</span> 'buffer
            <span class="org-builtin">:state</span>    #'consult--buffer-state
            <span class="org-builtin">:default</span>  t
            <span class="org-builtin">:items</span>    (<span class="org-keyword">lambda</span> () (consult--buffer-query
                                  <span class="org-builtin">:predicate</span> #'tabspaces--local-buffer-p
                                  <span class="org-builtin">:sort</span> 'visibility
                                  <span class="org-builtin">:as</span> #'buffer-name)))

      <span class="org-doc">"Set workspace buffer list for consult-buffer."</span>)
    (add-to-list 'consult-buffer-sources 'consult--source-workspace)))
</pre>
</div>
</div>
</div>

<div id="outline-container-tree-sitter" class="outline-3">
<h3 id="tree-sitter">tree-sitter</h3>
<div class="outline-text-3">
<p>
To build grammar:
</p>
<ul class="org-ul">
<li><code>git clone https://github.com/tree-sitter/tree-sitter-javascript</code></li>
<li><code>./build.sh python</code></li>
<li><code>cp dist/libtree-sitter-python.dylib ~/git/crafted-emacs/tree-sitter/</code></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">emacs</span>
  <span class="org-builtin">:ensure</span> nil
  <span class="org-builtin">:custom</span>
  (treesit-font-lock-level 3)
  <span class="org-builtin">:hook</span>
  (lsp-mode . (<span class="org-keyword">lambda</span> ()
                (<span class="org-keyword">when</span> (treesit-ready-p 'python)
                  (<span class="org-keyword">unless</span> (member '(python-mode . python-ts-mode) major-mode-remap-alist)
                    (add-to-list 'major-mode-remap-alist '(python-mode . python-ts-mode))))))
  <span class="org-builtin">:preface</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/init-py-ts-mode</span> ()
    (<span class="org-keyword">when</span> (treesit-ready-p 'python)
      (add-to-list 'major-mode-remap-alist '(python-mode . python-ts-mode))))
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">require</span> '<span class="org-constant">treesit</span>)
  (advice-add 'tab-switch <span class="org-builtin">:after</span> (<span class="org-keyword">lambda</span> (_) (<span class="org-keyword">interactive</span>) (lc/init-py-ts-mode)))
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-treemacs" class="outline-3">
<h3 id="treemacs">treemacs</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">treemacs</span>
  <span class="org-builtin">:bind</span>
  (<span class="org-string">"&lt;leader&gt;tp"</span> . 'treemacs)
  (<span class="org-builtin">:map</span> evil-treemacs-state-map
        (<span class="org-string">"SPC"</span> . evil-send-leader))
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">use-package</span> <span class="org-constant">treemacs-evil</span>
    <span class="org-builtin">:demand</span> t)
  (<span class="org-keyword">use-package</span> <span class="org-constant">treemacs-tab-bar</span>
    <span class="org-builtin">:demand</span> t
    <span class="org-builtin">:config</span>
    (treemacs-set-scope-type 'Tabs))
  (treemacs-follow-mode t)
  (treemacs-filewatch-mode t)
  (treemacs-fringe-indicator-mode 'always)
  (<span class="org-keyword">when</span> treemacs-python-executable
    (treemacs-git-commit-diff-mode t))


  )
</pre>
</div>
</div>
</div>

<div id="outline-container-vertico" class="outline-3">
<h3 id="vertico">vertico</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">savehist</span>
  <span class="org-builtin">:ensure</span> nil
  <span class="org-builtin">:init</span>
  (savehist-mode))

(<span class="org-keyword">use-package</span> <span class="org-constant">vertico</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">:hook</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">(minibuffer-setup . 'vertico-repeat-save)</span>
  <span class="org-builtin">:bind</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">("&lt;leader&gt;." . 'vertico-repeat)</span>
  (<span class="org-builtin">:map</span> vertico-map
        (<span class="org-string">"C-k"</span> . 'vertico-next)
        (<span class="org-string">"C-j"</span> . 'vertico-previous))
  <span class="org-builtin">:config</span>
  (vertico-reverse-mode)
  <span class="org-builtin">:custom</span>
  (vertico-resize t)
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-vterm-and-vterm-toggle" class="outline-3">
<h3 id="vterm-and-vterm-toggle">vterm and vterm-toggle</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">vterm</span>
  <span class="org-builtin">:bind</span>
  (<span class="org-builtin">:map</span> vterm-mode-map
        (<span class="org-string">"&lt;insert-state&gt; M-l"</span> . 'vterm-send-right)
        (<span class="org-string">"&lt;insert-state&gt; M-h"</span> . 'vterm-send-left))
  <span class="org-builtin">:custom</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">(vterm-shell (executable-find "fish"))</span>
  (vterm-shell (executable-find <span class="org-string">"zsh"</span>))
  (vterm-max-scrollback 10000))

(<span class="org-keyword">use-package</span> <span class="org-constant">vterm-toggle</span>
  <span class="org-builtin">:bind</span>
  (<span class="org-string">"&lt;leader&gt;'"</span> . 'vterm-toggle)
  <span class="org-builtin">:custom</span>
  (vterm-toggle-scope 'project))
</pre>
</div>
</div>
</div>

<div id="outline-container-xwidget-web-browser-enhancements" class="outline-3">
<h3 id="xwidget-web-browser-enhancements">xwidget web browser enhancements</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">xwwp-full</span>
  <span class="org-builtin">:vc</span> (<span class="org-builtin">:fetcher</span> <span class="org-string">"github"</span> <span class="org-builtin">:repo</span> <span class="org-string">"kchanqvq/xwwp"</span>)
  <span class="org-builtin">:bind</span>
  (<span class="org-builtin">:map</span> xwidget-webkit-mode-map
        (<span class="org-string">"&lt;localleader&gt;b"</span> .  'xwidget-webkit-back)
        (<span class="org-string">"&lt;localleader&gt;j"</span> .  'xwwp-ace-toggle)
        (<span class="org-string">"&lt;localleader&gt;o"</span> .  'xwwp-section)
        (<span class="org-string">"&lt;localleader&gt;h"</span> .  'xwwp-history-show))
  <span class="org-builtin">:custom</span>
  (xwwp-follow-link-completion-system 'default)
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">require</span> '<span class="org-constant">cl</span>))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-programming-languages" class="outline-2">
<h2 id="programming-languages">Programming languages</h2>
<div class="outline-text-2">
</div>
<div id="outline-container-lsp-mode" class="outline-3">
<h3 id="lsp-mode">lsp-mode</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">lsp-mode</span>
  <span class="org-builtin">:commands</span>
  (lsp-deferred)
  <span class="org-builtin">:hook</span>
  (lsp-mode . (<span class="org-keyword">lambda</span> ()
                (<span class="org-keyword">setq-local</span> evil-lookup-func #'lsp-describe-thing-at-point)))
  <span class="org-comment-delimiter">;; </span><span class="org-comment">:general</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">(lc/local-leader-keys</span>
  <span class="org-comment-delimiter">;;   </span><span class="org-comment">:states 'normal</span>
  <span class="org-comment-delimiter">;;   </span><span class="org-comment">:keymaps 'lsp-mode-map</span>
  <span class="org-comment-delimiter">;;   </span><span class="org-comment">"i" '(:ignore t :which-key "import")</span>
  <span class="org-comment-delimiter">;;   </span><span class="org-comment">"i o" '(lsp-organize-imports :wk "optimize")</span>
  <span class="org-comment-delimiter">;;   </span><span class="org-comment">"l" '(:keymap lsp-command-map :wk "lsp")</span>
  <span class="org-comment-delimiter">;;   </span><span class="org-comment">"a" '(lsp-execute-code-action :wk "code action")</span>
  <span class="org-comment-delimiter">;;   </span><span class="org-comment">"r" '(lsp-rename :wk "rename"))</span>
  <span class="org-builtin">:custom</span>
  (lsp-restart 'ignore)
  (lsp-eldoc-enable-hover nil)
  (lsp-enable-file-watchers nil)
  (lsp-signature-auto-activate nil)
  (lsp-modeline-diagnostics-enable nil)
  (lsp-keep-workspace-alive nil)
  (lsp-auto-execute-action nil)
  (lsp-before-save-edits nil)
  (lsp-headerline-breadcrumb-enable nil)
  <span class="org-builtin">:config</span>
  (add-to-list 'lsp-language-id-configuration '(python-ts-mode . <span class="org-string">"python"</span>))
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-lsp-ui" class="outline-3">
<h3 id="lsp-ui">lsp-ui</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">lsp-ui</span>
  <span class="org-builtin">:hook</span>
  (lsp-mode . lsp-ui-mode)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">:general</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">(lsp-ui-peek-mode-map</span>
  <span class="org-comment-delimiter">;;  </span><span class="org-comment">:states 'normal</span>
  <span class="org-comment-delimiter">;;  </span><span class="org-comment">"C-j" 'lsp-ui-peek--select-next</span>
  <span class="org-comment-delimiter">;;  </span><span class="org-comment">"C-k" 'lsp-ui-peek--select-prev)</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">(outline-mode-map</span>
  <span class="org-comment-delimiter">;;  </span><span class="org-comment">:states 'normal</span>
  <span class="org-comment-delimiter">;;  </span><span class="org-comment">"C-j" 'nil</span>
  <span class="org-comment-delimiter">;;  </span><span class="org-comment">"C-k" 'nil)</span>
  <span class="org-builtin">:custom</span>
  (lsp-ui-doc-show-with-cursor nil)
  (lsp-ui-doc-show-with-mouse nil)
  (lsp-ui-peek-always-show t)
  (lsp-ui-peek-fontify 'always)
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-clojure" class="outline-3">
<h3 id="clojure">clojure</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">clojure-mode</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-nix" class="outline-3">
<h3 id="nix">Nix</h3>
<div class="outline-text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">nix-mode</span>
<span class="org-builtin">:mode</span> <span class="org-string">"\\.nix\\'"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-python" class="outline-3">
<h3 id="python">Python</h3>
<div class="outline-text-3" id="text-python">
</div>
<div id="outline-container-python-mode" class="outline-4">
<h4 id="python-mode">python-mode</h4>
<div class="outline-text-4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">python-mode</span>
  <span class="org-builtin">:ensure</span> nil
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> python-indent-guess-indent-offset nil))
</pre>
</div>
</div>
</div>

<div id="outline-container-csv-mode" class="outline-4">
<h4 id="csv-mode">csv-mode</h4>
<div class="outline-text-4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">csv-mode</span>
  <span class="org-builtin">:hook</span> (csv-mode . lc/init-csv-mode)
  <span class="org-builtin">:bind</span>
  (<span class="org-builtin">:map</span> csv-mode-map
        (<span class="org-string">"&lt;localleader&gt;a"</span> . 'csv-align-fields)
        (<span class="org-string">"&lt;localleader&gt;A"</span> . 'lc/csv-align-visible)
        (<span class="org-string">"&lt;localleader&gt;i"</span> . 'lc/init-csv-mode)
        (<span class="org-string">"&lt;localleader&gt;u"</span> . 'csv-unalign-fields)
        (<span class="org-string">"&lt;localleader&gt;s"</span> . 'csv-sort-fields)
        (<span class="org-string">"&lt;localleader&gt;;"</span> . 'lc/set-csv-semicolon-separator)
        (<span class="org-string">"&lt;localleader&gt;,"</span> . 'lc/reset-csv-separators))
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/csv-align-visible</span> (<span class="org-type">&amp;optional</span> arg)
    <span class="org-doc">"Align visible fields"</span>
    (<span class="org-keyword">interactive</span> <span class="org-string">"P"</span>)
    (csv-align-fields nil (window-start) (window-end)))
  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/set-csv-semicolon-separator</span> ()
    (<span class="org-keyword">interactive</span>)
    (customize-set-variable 'csv-separators '(<span class="org-string">";"</span>)))
  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/reset-csv-separators</span> ()
    (<span class="org-keyword">interactive</span>)
    (customize-set-variable 'csv-separators lc/default-csv-separators))
  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/init-csv-mode</span> ()
    (<span class="org-keyword">interactive</span>)
    (lc/set-csv-separators)
    (lc/csv-highlight)
    (call-interactively 'csv-align-fields))
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">require</span> '<span class="org-constant">cl</span>)
  (<span class="org-keyword">require</span> '<span class="org-constant">color</span>)
  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/set-csv-separators</span> ()
    (<span class="org-keyword">interactive</span>)
    (<span class="org-keyword">let*</span> ((n-commas (count-matches <span class="org-string">","</span> (point-at-bol) (point-at-eol)))
           (n-semicolons (count-matches <span class="org-string">";"</span> (point-at-bol) (point-at-eol))))
      (<span class="org-keyword">if</span> ( <span class="org-comment-delimiter">; </span><span class="org-comment">&lt;</span>
           &gt; n-commas n-semicolons)
          (customize-set-variable 'csv-separators '(<span class="org-string">","</span> <span class="org-string">"       "</span>))
        (customize-set-variable 'csv-separators '(<span class="org-string">";"</span> <span class="org-string">" "</span>)))))
  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/csv-highlight</span> ()
    (<span class="org-keyword">interactive</span>)
    (font-lock-mode 1)
    (<span class="org-keyword">let*</span> ((separator (string-to-char (car csv-separators)))
           (n (count-matches (string separator) (point-at-bol) (point-at-eol)))
           (colors (loop for i from 0 to 1.0 by (/ 2.0 n)
                         collect (apply #'color-rgb-to-hex
                                        (color-hsl-to-rgb i 0.3 0.5)))))
      (loop for i from 2 to n by 2
            for c in colors
            for r = (format <span class="org-string">"^</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">%c\n]+%c</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">\\{</span><span class="org-string"><span class="org-variable-name">%d\\</span></span><span class="org-string">}"</span> separator separator i)
            do (font-lock-add-keywords nil `((,r (1 '(face (<span class="org-builtin">:foreground</span> ,c)))))))))
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-direnv" class="outline-4">
<h4 id="direnv">direnv</h4>
<div class="outline-text-4">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">(use-package inheritenv)</span>

(<span class="org-keyword">use-package</span> <span class="org-constant">envrc</span>
  <span class="org-builtin">:hook</span>
  (python-mode python-ts-mode org-jupyter-mode))

<span class="org-comment-delimiter">;; </span><span class="org-comment">(use-package direnv</span>
<span class="org-comment-delimiter">;;  </span><span class="org-comment">:vc (:fetcher "github" :repo "wyuenho/emacs-direnv" :rev "early-reliable-update-env")</span>
<span class="org-comment-delimiter">;;  </span><span class="org-comment">:config</span>
<span class="org-comment-delimiter">;;  </span><span class="org-comment">(direnv-mode))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-lsp-pyright" class="outline-4">
<h4 id="lsp-pyright">lsp-pyright</h4>
<div class="outline-text-4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">lsp-pyright</span>
  <span class="org-builtin">:hook</span>
  (python-base-mode . (<span class="org-keyword">lambda</span> ()
                        (<span class="org-keyword">require</span> '<span class="org-constant">lsp-pyright</span>)
                        (lc/init-pyright)
                        (lsp-deferred)))
  <span class="org-builtin">:custom</span>
  (lsp-pyright-typechecking-mode <span class="org-string">"basic"</span>)
  <span class="org-builtin">:preface</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/init-pyright</span> ()
    (lsp-register-client
     (make-lsp-client
      <span class="org-builtin">:new-connection</span> (lsp-stdio-connection (<span class="org-keyword">lambda</span> ()
                                              (cons (lsp-package-path 'pyright)
                                                    lsp-pyright-langserver-command-args)))
      <span class="org-comment-delimiter">;; </span><span class="org-comment">NOTE: only change is here, adding python-ts-mode</span>
      <span class="org-builtin">:major-modes</span> '(python-mode python-ts-mode)
      <span class="org-builtin">:server-id</span> 'pyright
      <span class="org-builtin">:multi-root</span> lsp-pyright-multi-root
      <span class="org-builtin">:priority</span> 3
      <span class="org-builtin">:initialized-fn</span> (<span class="org-keyword">lambda</span> (workspace)
                        (with-lsp-workspace workspace
                          <span class="org-comment-delimiter">;; </span><span class="org-comment">we send empty settings initially, LSP server will ask for the</span>
                          <span class="org-comment-delimiter">;; </span><span class="org-comment">configuration of each workspace folder later separately</span>
                          (lsp--set-configuration
                           (make-hash-table <span class="org-builtin">:test</span> 'equal))))
      <span class="org-builtin">:download-server-fn</span> (<span class="org-keyword">lambda</span> (_client callback error-callback _update?)
                            (lsp-package-ensure 'pyright callback error-callback))
      <span class="org-builtin">:notification-handlers</span> (lsp-ht (<span class="org-string">"pyright/beginProgress"</span> 'lsp-pyright--begin-progress-callback)
                                     (<span class="org-string">"pyright/reportProgress"</span> 'lsp-pyright--report-progress-callback)
                                     (<span class="org-string">"pyright/endProgress"</span> 'lsp-pyright--end-progress-callback))))
    ))
</pre>
</div>
</div>
</div>

<div id="outline-container-dap-mode" class="outline-4">
<h4 id="dap-mode">dap-mode</h4>
<div class="outline-text-4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">dap-mode</span>
  <span class="org-builtin">:hook</span>
  (<span class="org-comment-delimiter">;; </span><span class="org-comment">(dap-mode . corfu-mode)</span>
   (dap-terminated . lc/hide-debug-windows)
   <span class="org-comment-delimiter">;; </span><span class="org-comment">(dap-stopped  . lc/switch-to-output-buf)</span>
   <span class="org-comment-delimiter">;; </span><span class="org-comment">(dap-session-created . (lambda (_arg) (projectile-save-project-buffers)))</span>
   (dap-ui-repl-mode . (<span class="org-keyword">lambda</span> () (<span class="org-keyword">setq-local</span> truncate-lines t))))
  <span class="org-builtin">:bind</span>
  (<span class="org-builtin">:map</span> python-base-mode-map
        (<span class="org-string">"&lt;localleader&gt;dd"</span> . 'dap-debug)
        (<span class="org-string">"&lt;localleader&gt;db"</span> . 'dap-breakpoint-toggle)
        <span class="org-comment-delimiter">;; </span><span class="org-comment">"d B" '(dap-ui-breakpoints-list :wk "breakpoint list")</span>
        (<span class="org-string">"&lt;localleader&gt;dc"</span> . 'dap-continue)
        (<span class="org-string">"&lt;localleader&gt;dn"</span> . 'dap-next)
        (<span class="org-string">"&lt;localleader&gt;de"</span> . 'dap-eval-thing-at-point)
        (<span class="org-string">"&lt;localleader&gt;di"</span> . 'dap-step-in)
        (<span class="org-string">"&lt;localleader&gt;dl"</span> . 'dap-debug-last)
        (<span class="org-string">"&lt;localleader&gt;dq"</span> . 'dap-disconnect)
        (<span class="org-string">"&lt;localleader&gt;dr"</span> . 'dap-ui-repl)
        (<span class="org-string">"&lt;localleader&gt;di"</span> . 'lc/dap-inspect-df)
        <span class="org-comment-delimiter">;; </span><span class="org-comment">templates</span>
        (<span class="org-string">"&lt;localleader&gt;dt"</span> . (<span class="org-keyword">lambda</span> () (<span class="org-keyword">interactive</span>) (dap-debug dap-test-args)))
        (<span class="org-string">"&lt;localleader&gt;ds"</span> . (<span class="org-keyword">lambda</span> () (<span class="org-keyword">interactive</span>) (dap-debug dap-script-args))))
  (<span class="org-builtin">:map</span> dap-ui-repl-mode-map
        (<span class="org-string">"&lt;insert-state&gt;&lt;up&gt;"</span> . 'comint-previous-input))
  <span class="org-builtin">:preface</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/dap-inspect-df</span> (dataframe)
    <span class="org-doc">"Save the df to csv and open the file with csv-mode"</span>
    (<span class="org-keyword">interactive</span> (list (read-from-minibuffer <span class="org-string">"DataFrame: "</span> (evil-find-symbol nil))))
    (dap-eval (format  <span class="org-string">"%s.to_csv('</span><span class="org-string"><span class="org-constant">%s</span></span><span class="org-string">', index=False)"</span> dataframe lc/dap-temp-dataframe-path))
    (sleep-for 1)
    (find-file-other-window lc/dap-temp-dataframe-path))
  <span class="org-comment-delimiter">;; </span><span class="org-comment">hide stdout window  when done</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/hide-debug-windows</span> (session)
    <span class="org-doc">"Hide debug windows when all debug sessions are dead."</span>
    (<span class="org-keyword">unless</span> (-filter 'dap--session-running (dap--get-sessions))
      (lc/kill-output-buffer)))
  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/dap-python--executable-find</span> (orig-fun <span class="org-type">&amp;rest</span> args)
    (executable-find <span class="org-string">"python"</span>))
  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/kill-output-buffer</span> ()
    <span class="org-doc">"Go to output buffer."</span>
    (<span class="org-keyword">interactive</span>)
    (<span class="org-keyword">let</span> ((win (display-buffer-in-side-window
                (dap--debug-session-output-buffer (dap--cur-session-or-die))
                `((side . bottom) (slot . 5) (window-width . 0.20)))))
      (delete-window win)))
  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/window-resize-to-percentage</span> (percentage)
    (<span class="org-keyword">interactive</span>)
    (window-resize nil (- (truncate (* percentage (frame-height))) (window-height))))
  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/reset-dap-windows</span> ()
    (<span class="org-keyword">interactive</span>)
    <span class="org-comment-delimiter">;; </span><span class="org-comment">display sessions and repl</span>
    (<span class="org-keyword">seq-doseq</span> (feature-start-stop dap-auto-configure-features)
      (<span class="org-keyword">when-let</span>
          (start-stop (alist-get feature-start-stop
                                 <span class="org-comment-delimiter">;; </span><span class="org-comment">&lt;</span>
                                 dap-features-&gt;windows
                                 ))
        (funcall (car start-stop))))
    <span class="org-comment-delimiter">;; </span><span class="org-comment">display output buffer</span>
    (<span class="org-keyword">save-excursion</span> (dap-go-to-output-buffer t))
    <span class="org-comment-delimiter">;; </span><span class="org-comment">resize window</span>
    (<span class="org-keyword">save-window-excursion</span>
      <span class="org-comment-delimiter">;; </span><span class="org-comment">switch to main window</span>
      (winum-select-window-1)
      (lc/window-resize-to-percentage 0.66)))
  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/switch-to-output-buf</span> ()
    (<span class="org-keyword">when-let*</span> ((splits (split-string buffer-file-name <span class="org-string">"/"</span>))
                (bla (car (last splits))))
      (<span class="org-keyword">when</span> (string-equal bla <span class="org-string">"pytest.py"</span>)
        (switch-to-buffer (dap--debug-session-output-buffer (dap--cur-session-or-die))))))
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> lc/dap-temp-dataframe-buffer  <span class="org-string">"*inspect-df*"</span>)
  (<span class="org-keyword">setq</span> lc/dap-temp-dataframe-path <span class="org-string">"~/tmp-inspect-df.csv"</span>)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">prevent minibuffer prompt about reloading from disk</span>
  (<span class="org-keyword">setq</span> revert-without-query '(<span class="org-string">"~/tmp-inspect-df.csv"</span>))
  <span class="org-comment-delimiter">;; </span><span class="org-comment">(setq dap-auto-configure-features '(locals repl))</span>
  (<span class="org-keyword">setq</span> dap-auto-configure-features '(sessions repl))
  (<span class="org-keyword">setq</span> dap-python-debugger 'debugpy)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">show stdout</span>
  (<span class="org-keyword">setq</span> dap-auto-show-output t)
  (<span class="org-keyword">setq</span> dap-output-window-min-height 10)
  (<span class="org-keyword">setq</span> dap-output-window-max-height 200)
  (<span class="org-keyword">setq</span> dap-overlays-use-overlays nil)
  <span class="org-builtin">:config</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">configure windows</span>
  (<span class="org-keyword">require</span> '<span class="org-constant">dap-ui</span>)
  (<span class="org-keyword">setq</span> dap-ui-buffer-configurations
        '((<span class="org-string">"*dap-ui-sessions*"</span>
           (side . bottom)
           (slot . 1)
           (window-height . 0.33))
          (<span class="org-string">"*debug-window*"</span>
           (side . bottom)
           (slot . 2)
           (window-height . 0.33))
          (<span class="org-string">"*dap-ui-repl*"</span>
           (side . bottom)
           (slot . 3)
           (window-height . 0.33))))
  (dap-ui-mode 1)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">python virtualenv</span>
  (<span class="org-keyword">require</span> '<span class="org-constant">dap-python</span>)
  (advice-add 'dap-python--pyenv-executable-find <span class="org-builtin">:around</span> #'lc/dap-python--executable-find)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">debug templates</span>
  (<span class="org-keyword">defvar</span> <span class="org-variable-name">dap-script-args</span> (list <span class="org-builtin">:type</span> <span class="org-string">"python"</span>
                                <span class="org-builtin">:args</span> []
                                <span class="org-builtin">:cwd</span> <span class="org-string">"${workspaceFolder}"</span>
                                <span class="org-builtin">:justMyCode</span> <span class="org-builtin">:json-false</span>
                                <span class="org-builtin">:request</span> <span class="org-string">"launch"</span>
                                <span class="org-builtin">:debugger</span> 'debugpy
                                <span class="org-builtin">:name</span> <span class="org-string">"dap-debug-script"</span>))
  (<span class="org-keyword">defvar</span> <span class="org-variable-name">dap-test-args</span> (list <span class="org-builtin">:type</span> <span class="org-string">"python-test-at-point"</span>
                              <span class="org-builtin">:args</span> <span class="org-string">""</span>
                              <span class="org-builtin">:justMyCode</span> <span class="org-builtin">:json-false</span>
                              <span class="org-comment-delimiter">;; </span><span class="org-comment">:cwd "${workspaceFolder}"</span>
                              <span class="org-builtin">:request</span> <span class="org-string">"launch"</span>
                              <span class="org-builtin">:module</span> <span class="org-string">"pytest"</span>
                              <span class="org-builtin">:debugger</span> 'debugpy
                              <span class="org-builtin">:name</span> <span class="org-string">"dap-debug-test-at-point"</span>))
  (<span class="org-keyword">defvar</span> <span class="org-variable-name">eco-cold-start</span> (list
                          <span class="org-builtin">:name</span> <span class="org-string">"mill"</span>
                          <span class="org-builtin">:type</span> <span class="org-string">"python"</span>
                          <span class="org-builtin">:request</span> <span class="org-string">"launch"</span>
                          <span class="org-builtin">:program</span> (expand-file-name <span class="org-string">"~/git/ran_optimization/scripts_smart_sleep_orchestration/find_cold_start_smart_sleep_thresholds.py"</span>)
                          <span class="org-comment-delimiter">;; </span><span class="org-comment">:env '(("NO_JSON_LOG" . "true"))</span>
                          <span class="org-comment-delimiter">;; </span><span class="org-comment">:args ["-m" "mill" "--config" "user_luca"]</span>
                          ))

  (dap-register-debug-template <span class="org-string">"dap-debug-script"</span> dap-script-args)
  (dap-register-debug-template <span class="org-string">"dap-debug-test-at-point"</span> dap-test-args)
  (dap-register-debug-template <span class="org-string">"eco-cold-start"</span> eco-cold-start)
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-flymake-ruff" class="outline-4">
<h4 id="flymake-ruff">flymake-ruff</h4>
<div class="outline-text-4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">flymake-ruff</span>
  <span class="org-builtin">:hook</span>
  (python-base-mode . flymake-ruff-load))
</pre>
</div>
</div>
</div>

<div id="outline-container-jupyter" class="outline-4">
<h4 id="jupyter">jupyter</h4>
<div class="outline-text-4">
<p>
<code>zmq</code> installation:
</p>
<ul class="org-ul">
<li>Need to have <code>automake</code>, <code>autoconf</code></li>
<li>In <code>straight/build/zmq/src</code> run <code>autoreconf -i</code></li>
<li>In <code>straight/build/zmq</code> run <code>make</code></li>
</ul>

<p>
<code>emacs-zmq</code> installation:
</p>
<ul class="org-ul">
<li>In <code>straight/build/emacs-zmq</code> run <code>wget https://github.com/nnicandro/emacs-zmq/releases/download/v0.10.10/emacs-zmq-x86_64-apple-darwin17.4.0.tar.gz</code></li>
<li>Then <code>tar -xzf emacs-zmq-x86_64-apple-darwin17.4.0.tar.gz</code></li>
<li>Finally <code>cp emacs-zmq-x86_64-apple-darwin17.4.0/emacs-zmq.so emacs-zmq.dylib</code></li>
</ul>

<p>
Compile by hand:
</p>
<ul class="org-ul">
<li><code>git clone https://github.com/nnicandro/emacs-zmq.git</code></li>
<li><code>cd emacs-zmq &amp;&amp; make</code></li>
<li><code>cp src/.libs/emacs-zmq.dylib ../crafted-emacs/personal/elpa/zmq-0.10.10/</code></li>

<li>In the REPL you can use <code>M-p</code> / <code>M-n</code> to navigate previous prompts</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">jupyter</span>
  <span class="org-builtin">:vc</span> (<span class="org-builtin">:fetcher</span> <span class="org-string">"github"</span> <span class="org-builtin">:repo</span> <span class="org-string">"nnicandro/emacs-jupyter"</span>)
  <span class="org-builtin">:bind</span>
  (<span class="org-builtin">:map</span> python-base-mode-map
        (<span class="org-string">"&lt;localleader&gt;ee"</span> . 'jupyter-eval-line-or-region)
        (<span class="org-string">"&lt;visual-state&gt;&lt;localleader&gt;e"</span> . 'jupyter-eval-line-or-region)
        (<span class="org-string">"&lt;localleader&gt;ed"</span> . 'jupyter-eval-defun)
        (<span class="org-string">"&lt;localleader&gt;eb"</span> . 'jupyter-eval-buffer)
        <span class="org-comment-delimiter">;; </span><span class="org-comment">("&lt;localleader&gt;eb" . (lambda () (interactive) (lc/jupyter-eval-buffer)))</span>
        (<span class="org-string">"&lt;localleader&gt;er"</span> . 'jupyter-eval-remove-overlays)
        (<span class="org-string">"&lt;localleader&gt;kd"</span> . 'lc/kill-repl-kernel)
        (<span class="org-string">"&lt;localleader&gt;ki"</span> . 'jupyter-org-interrupt-kernel)
        (<span class="org-string">"&lt;localleader&gt;kr"</span> . 'jupyter-repl-restart-kernel)
        <span class="org-comment-delimiter">;; </span><span class="org-comment">("&lt;localleader&gt;J" . 'lc/jupyter-repl)</span>
        )
  (<span class="org-builtin">:map</span> org-mode-map
        (<span class="org-string">"&lt;localleader&gt;="</span> . (<span class="org-keyword">lambda</span> () (<span class="org-keyword">interactive</span>) (jupyter-org-insert-src-block t nil)))
        (<span class="org-string">"&lt;localleader&gt;m"</span> . 'jupyter-org-merge-blocks)
        (<span class="org-string">"&lt;localleader&gt;+"</span> . 'jupyter-org-insert-src-block)
        (<span class="org-string">"&lt;localleader&gt;?"</span> . 'jupyter-inspect-at-point)
        (<span class="org-string">"&lt;localleader&gt;c"</span> . 'jupyter-org-clear-all-results)
        (<span class="org-string">"&lt;localleader&gt;x"</span> . 'jupyter-org-kill-block-and-results))
  <span class="org-builtin">:hook</span>
  (jupyter-repl-persistent-mode .   (<span class="org-keyword">lambda</span> () (<span class="org-keyword">setq-local</span> evil-lookup-func #'jupyter-inspect-at-point)))
  <span class="org-builtin">:custom</span>
  (jupyter-repl-prompt-margin-width 4)
  (jupyter-eval-use-overlays nil)
  <span class="org-builtin">:preface</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">jupyter-command-venv</span> (<span class="org-type">&amp;rest</span> args)
    <span class="org-doc">"This overrides jupyter-command to use the virtualenv's jupyter"</span>
    (<span class="org-keyword">let</span> ((jupyter-executable (executable-find <span class="org-string">"jupyter"</span>)))
      (<span class="org-keyword">with-temp-buffer</span>
        (<span class="org-keyword">when</span> (zerop (apply #'process-file jupyter-executable nil t nil args))
          (string-trim-right (buffer-string))))))
  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/jupyter-eval-buffer</span> ()
    <span class="org-doc">"Send the contents of BUFFER using `</span><span class="org-doc"><span class="org-constant">jupyter-current-client</span></span><span class="org-doc">'."</span>
    (<span class="org-keyword">interactive</span>)
    (jupyter-eval-string (jupyter-load-file-code (buffer-file-name))))
  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/jupyter-repl</span> ()
    <span class="org-doc">"If a buffer is already associated with a jupyter buffer, then pop to it. Otherwise start a jupyter kernel."</span>
    (<span class="org-keyword">interactive</span>)
    (<span class="org-keyword">if</span> (<span class="org-keyword">bound-and-true-p</span> jupyter-current-client)
        (jupyter-repl-pop-to-buffer)
      (call-interactively 'jupyter-repl-associate-buffer)))
  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/kill-repl-kernel</span> ()
    <span class="org-doc">"Kill repl buffer associated with current jupyter kernel"</span>
    (<span class="org-keyword">interactive</span>)
    (<span class="org-keyword">if</span> jupyter-current-client
        (jupyter-with-repl-buffer jupyter-current-client
          (kill-buffer (current-buffer)))
      (<span class="org-warning">error</span> <span class="org-string">"Buffer not associated with a REPL, see `</span><span class="org-string"><span class="org-constant">jupyter-repl-associate-buffer</span></span><span class="org-string">'"</span>)))
  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/jupyter-toggle-overlays</span> ()
    (<span class="org-keyword">interactive</span>)
    (<span class="org-keyword">if</span> jupyter-eval-use-overlays
        (<span class="org-keyword">setq</span> jupyter-eval-use-overlays nil)
      (<span class="org-keyword">setq</span> jupyter-eval-use-overlays t)))
  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/jupyter-inspect-df</span> (dataframe)
    <span class="org-doc">"Save the df to csv and open the file with csv-mode"</span>
    (<span class="org-keyword">interactive</span> (list (read-from-minibuffer <span class="org-string">"DataFrame: "</span> (evil-find-symbol nil))))
    (jupyter-eval (format  <span class="org-string">"%s.to_csv('</span><span class="org-string"><span class="org-constant">%s</span></span><span class="org-string">', index=False)"</span> dataframe lc/jupyter-temp-dataframe-path))
    (find-file-other-window lc/jupyter-temp-dataframe-path))
  <span class="org-builtin">:init</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">TODO refactor to avoid duplication of dap code</span>
  (<span class="org-keyword">setq</span> lc/jupyter-temp-dataframe-buffer  <span class="org-string">"*inspect-df*"</span>)
  (<span class="org-keyword">setq</span> lc/jupyter-temp-dataframe-path <span class="org-string">"~/tmp-inspect-df.csv"</span>)
  (advice-add 'jupyter-command <span class="org-builtin">:override</span> #'jupyter-command-venv)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">stop spawning output buffer</span>
  (add-to-list 'display-buffer-alist
               '(<span class="org-string">"\\*jupyter-output\\*</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">\\*jupyter-error\\*"</span>
                 (cons 'display-buffer-no-window
                       '((allow-no-window . t)))))
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">require</span> '<span class="org-constant">python</span>)
  (<span class="org-keyword">require</span> '<span class="org-constant">treesit</span>)
  (evil-define-key 'normal 'python-ts-mode-map
    (kbd <span class="org-string">"&lt;localleader&gt;J"</span>) 'lc/jupyter-repl))
</pre>
</div>
</div>
</div>

<div id="outline-container-org-jupyter-mode" class="outline-4">
<h4 id="org-jupyter-mode">Org jupyter mode</h4>
<div class="outline-text-4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">emacs</span>
  <span class="org-builtin">:hook</span>
  ((org-jupyter-mode . (<span class="org-keyword">lambda</span> ()
                         <span class="org-comment-delimiter">;; </span><span class="org-comment">otherwise jupyter-associate-buffer will fail</span>
                         (<span class="org-keyword">setq</span> major-mode-remap-alist '())
                         (<span class="org-keyword">setq-local</span> evil-lookup-func #'jupyter-inspect-at-point)
                         <span class="org-comment-delimiter">;; </span><span class="org-comment">disable annoying insert-new-line-and-indent behavior</span>
                         <span class="org-comment-delimiter">;; </span><span class="org-comment">(setq-local indent-line-function 'lc/no-indent)</span>
                         ))
   (org-mode . (<span class="org-keyword">lambda</span> () (<span class="org-keyword">when</span> (lc/is-jupyter-org-buffer?) (org-jupyter-mode)))))
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/no-indent</span> () 'noindent)
  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/is-jupyter-org-buffer?</span> ()
    (<span class="org-keyword">with-current-buffer</span> (buffer-name)
      (goto-char (point-min))
      (re-search-forward <span class="org-string">"begin_src jupyter-"</span> 10000 t)))
  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/org-cycle-or-py-complete</span> (orig-fun <span class="org-type">&amp;rest</span> args)
    <span class="org-doc">"If in a jupyter-python code block, call py-indent-or-complete, otherwise use org-cycle"</span>
    (<span class="org-keyword">if</span> (<span class="org-keyword">and</span> (org-in-src-block-p)
             (eq (intern (org-element-property <span class="org-builtin">:language</span> (org-element-at-point))) 'jupyter-python))
        (lc/py-indent-or-complete)
      (apply orig-fun args)))
  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/py-indent-or-complete</span> ()
    (<span class="org-keyword">interactive</span> <span class="org-string">"*"</span>)
    (window-configuration-to-register py--windows-config-register)
    (<span class="org-keyword">cond</span> ((use-region-p)
           (py-indent-region (region-beginning) (region-end)))
          ((<span class="org-keyword">or</span> (bolp)
               (member (char-before) (list 9 10 12 13 32 ?:  <span class="org-comment-delimiter">;; </span><span class="org-comment">{[(</span>
                                           ?\) ?\] ?\}))
               <span class="org-comment-delimiter">;; </span><span class="org-comment">(not (looking-at "[ \t]*$"))</span>
               )
           (py-indent-line))
          ((comint-check-proc (current-buffer))
           (<span class="org-keyword">ignore-errors</span> (completion-at-point)))
          (t
           (completion-at-point))))
  (<span class="org-keyword">define-minor-mode</span> <span class="org-function-name">org-jupyter-mode</span>
    <span class="org-doc">"Minor mode which is active when an org file has the string begin_src jupyter-python</span>
<span class="org-doc">    in the first few hundred rows"</span>
    <span class="org-builtin">:keymap</span> (<span class="org-keyword">let</span> ((map (make-sparse-keymap)))
              map)))
</pre>
</div>
</div>
</div>

<div id="outline-container-scimax-jupyter" class="outline-4">
<h4 id="scimax-jupyter">scimax-jupyter</h4>
<div class="outline-text-4">
<p>
Notes:
</p>
<ul class="org-ul">
<li>We can only load <code>scimax-jupyter</code> when we have <code>jupyter</code> on our <code>PATH</code>.
<ul class="org-ul">
<li>We assume <code>jupyter</code> is always installed in a virtual env associated with an <code>.envrc</code> file</li>
<li>We load jupyter when we activate <code>envrc-mode</code> if <code>jupyter</code> is available</li>
</ul></li>
<li>We need to add a <code>:session</code> to each code block
<ul class="org-ul">
<li>We can use the template <code>&lt;ha</code></li>
</ul></li>
<li>Use <code>:display plain</code> to remove clever displaying
<ul class="org-ul">
<li>We can use the template <code>&lt;dp</code></li>
</ul></li>
<li>Use <code>toggle-truncate-lines</code> when printing dataframes</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">scimax-jupyter</span>
  <span class="org-builtin">:load-path</span> <span class="org-string">"~/git/scimax"</span>
  <span class="org-builtin">:bind</span>
  (<span class="org-builtin">:map</span> org-jupyter-mode-map
        (<span class="org-string">"&lt;localleader&gt;?"</span> . 'scimax-jupyter-org-hydra/body)
        (<span class="org-string">"&lt;localleader&gt;K"</span> . (<span class="org-keyword">lambda</span> () (<span class="org-keyword">interactive</span>)
                              (scimax-jupyter-org-kill-kernel)
                              (<span class="org-keyword">setq</span> header-line-format nil)
                              (message <span class="org-string">"killer jupyter kernel"</span>))))
  <span class="org-builtin">:hook</span>
  (envrc-mode . lc/init-jupyter)
  <span class="org-builtin">:preface</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/replace-in-alist</span> (input key new_value)
    (mapcar (<span class="org-keyword">lambda</span> (pair)
              (<span class="org-keyword">if</span> (equal (car pair) key)
                  (cons (car pair) new_value)
                pair))
            input))
  (<span class="org-keyword">defun</span> <span class="org-function-name">lc/init-jupyter</span> ()
    (<span class="org-keyword">interactive</span>)
    <span class="org-comment-delimiter">;; </span><span class="org-comment">only try to load in org-mode</span>
    (<span class="org-keyword">when</span> (derived-mode-p 'org-mode)
      <span class="org-comment-delimiter">;; </span><span class="org-comment">skip if already loaded</span>
      (<span class="org-keyword">unless</span> (member '(jupyter . t) org-babel-load-languages)
        <span class="org-comment-delimiter">;; </span><span class="org-comment">only load if jupyter is available</span>
        (<span class="org-keyword">if</span> (executable-find <span class="org-string">"jupyter"</span>)
            (with-no-warnings
              (<span class="org-keyword">require</span> '<span class="org-constant">scimax-jupyter</span>)
              <span class="org-comment-delimiter">;; </span><span class="org-comment">(setq org-src-lang-modes</span>
              <span class="org-comment-delimiter">;;       </span><span class="org-comment">(lc/replace-in-alist org-src-lang-modes "jupyter-python" 'python-ts))</span>
              )
          (message <span class="org-string">"could not initialize scimax-jupyter!"</span>)))))
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">scimax-jupyter-get-session</span> ()
    <span class="org-doc">"Get the session name in the current buffer."</span>
    (<span class="org-keyword">let</span> ((lang (car (org-babel-get-src-block-info))))
      (<span class="org-keyword">or</span>
       (cdr
        (assoc <span class="org-builtin">:session</span>
               <span class="org-comment-delimiter">;; </span><span class="org-comment">NOTE: replaced '</span><span class="org-comment"><span class="org-constant">cadr</span></span><span class="org-comment">' with '</span><span class="org-comment"><span class="org-constant">car</span></span><span class="org-comment">' here</span>
               (car (org-babel-params-from-properties lang))))
       (cdr (assoc <span class="org-builtin">:session</span>
                   org-babel-default-header-args:jupyter-python))))))
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-global-keybindings" class="outline-2">
<h2 id="global-keybindings">Global keybindings</h2>
<div class="outline-text-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">evil</span>
  <span class="org-builtin">:config</span>
  (evil-define-key 'normal 'global
    (kbd <span class="org-string">"&lt;leader&gt;SPC"</span>) 'execute-extended-command
    (kbd <span class="org-string">"&lt;leader&gt;R"</span>) 'restart-emacs
    (kbd <span class="org-string">"&lt;leader&gt;;"</span>) 'eval-expression
    <span class="org-comment-delimiter">;; </span><span class="org-comment">previous buffer</span>
    (kbd <span class="org-string">"&lt;leader&gt;`"</span>) '(lambda () (<span class="org-keyword">interactive</span>) (switch-to-buffer (other-buffer (current-buffer) 1)))
    (kbd <span class="org-string">"&lt;leader&gt;bd"</span>)  'kill-current-buffer
    (kbd <span class="org-string">"&lt;leader&gt;br"</span>)  'revert-buffer
    <span class="org-comment-delimiter">;; </span><span class="org-comment">delete file</span>
    (kbd <span class="org-string">"&lt;leader&gt;fD"</span>)  '(lambda () (<span class="org-keyword">interactive</span>) (delete-file (buffer-file-name)))
    (kbd <span class="org-string">"&lt;leader&gt;ff"</span>)  'find-file
    (kbd <span class="org-string">"&lt;leader&gt;fR"</span>)  'rename-visited-file
    (kbd <span class="org-string">"&lt;leader&gt;fs"</span>)  'save-buffer
    (kbd <span class="org-string">"&lt;leader&gt;he"</span>)  'view-echo-area-messages
    (kbd <span class="org-string">"&lt;leader&gt;hf"</span>)  'describe-function
    (kbd <span class="org-string">"&lt;leader&gt;hk"</span>)  'describe-key
    (kbd <span class="org-string">"&lt;leader&gt;hK"</span>)  'describe-keymap
    (kbd <span class="org-string">"&lt;leader&gt;hl"</span>)  'view-lossage
    (kbd <span class="org-string">"&lt;leader&gt;hL"</span>)  'find-library
    (kbd <span class="org-string">"&lt;leader&gt;hp"</span>)  'describe-package
    (kbd <span class="org-string">"&lt;leader&gt;hv"</span>)  'describe-variable
    <span class="org-comment-delimiter">;; </span><span class="org-comment">lisp</span>
    (kbd <span class="org-string">"&lt;leader&gt;lr"</span>)  'raise-sexp
    (kbd <span class="org-string">"&lt;leader&gt;lb"</span>)  'sp-forward-barf-sexp
    (kbd <span class="org-string">"&lt;leader&gt;ls"</span>)  'sp-forward-slurp-sexp
    (kbd <span class="org-string">"&lt;leader&gt;td"</span>)  'toggle-debug-on-error
    (kbd <span class="org-string">"&lt;leader&gt;tl"</span>)  'display-line-numbers-mode
    <span class="org-comment-delimiter">;; </span><span class="org-comment">toggle wrapped lines</span>
    (kbd <span class="org-string">"&lt;leader&gt;tw"</span>)  '(lambda () (<span class="org-keyword">interactive</span>) (toggle-truncate-lines))
    (kbd <span class="org-string">"&lt;leader&gt;tt"</span>)  'lc/modus-themes-toggle
    (kbd <span class="org-string">"&lt;leader&gt;tm"</span>)  'toggle-frame-maximized
    (kbd <span class="org-string">"&lt;leader&gt;u"</span>)  'universal-argument
    (kbd <span class="org-string">"&lt;leader&gt;wd"</span>)  'delete-window
    (kbd <span class="org-string">"&lt;leader&gt;wh"</span>)  'windmove-left
    (kbd <span class="org-string">"&lt;leader&gt;wl"</span>)  'windmove-right
    (kbd <span class="org-string">"&lt;leader&gt;wk"</span>)  'windmove-up
    (kbd <span class="org-string">"&lt;leader&gt;wj"</span>)  'windmove-down
    (kbd <span class="org-string">"&lt;leader&gt;wm"</span>)  'delete-other-windows
    (kbd <span class="org-string">"&lt;leader&gt;wr"</span>)  'winner-redo
    (kbd <span class="org-string">"&lt;leader&gt;ws"</span>)  'evil-window-split
    (kbd <span class="org-string">"&lt;leader&gt;wu"</span>)  'winner-undo
    (kbd <span class="org-string">"&lt;leader&gt;wv"</span>)  'evil-window-vsplit
    (kbd <span class="org-string">"&lt;leader&gt;w="</span>)  'balance-windows-area)
  (evil-define-key 'insert 'global
    (kbd <span class="org-string">"&lt;leader&gt;SPC"</span>) 'execute-extended-command
    (kbd <span class="org-string">"M-&lt;tab&gt;"</span>) 'complete-symbol)
  (evil-define-key 'visual 'global
    (kbd <span class="org-string">"&lt;leader&gt;SPC"</span>) 'execute-extended-command)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">dired</span>
  (evil-define-key 'normal dired-mode-map
    (kbd <span class="org-string">"SPC"</span>) 'evil-send-leader
    (kbd <span class="org-string">"h"</span>) 'dired-up-directory
    (kbd <span class="org-string">"l"</span>) 'dired-find-file)
  )
</pre>
</div>
</div>
</div>

  </section>
</article>

    </main>

    <footer class="py-10 print:hidden">
      
      <div class="flex justify-between">
  <div>
    <p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
      Luca Cambiaghi
    </p>
    <p class="text-xs text-neutral-500 dark:text-neutral-400">Theme inspired by
      <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href="https://git.io/hugo-congo" target=_blank rel="noopener noreferrer">Congo</a>
    </p>
  </div>
  <div class="text-sm cursor-pointer text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400 ltr:mr-14 rtl:ml-14">
    <button id=appearance-switcher class="w-12 h-12" type=button title="Switch to dark appearance">
      <span class="inline dark:hidden"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></span><span class="hidden dark:inline"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></span></button></div></div>

      
    </footer>

  </body>
</html>
