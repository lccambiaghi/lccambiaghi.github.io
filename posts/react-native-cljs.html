<!doctype html>
<html lang="en-us" class=scroll-smooth data-default-appearance=light data-auto-appearance=true>
  <head>
    
    <!-- Clicky -->
    <script>var clicky_site_ids = clicky_site_ids || []; clicky_site_ids.push(101320555);</script>
    <script async src="//static.getclicky.com/js"></script>
    <!-- Clicky -->
    <meta charset="utf-8">
    <title>Luca's blog - Home</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Luca Cambiaghi" />
    <meta name="description" content="Luca&#39;s blog" />
    <meta name="keywords" content="" />
    <link rel="stylesheet" href="https://lucacambiaghi.com/static/style.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">
    <script async src="https://talk.hyvor.com/embed/embed.js" type="module"></script>
    <script type=text/javascript src="https://lucacambiaghi.com/static//js/appearance.js"></script>
    <script defer type=text/javascript id=script-bundle src="https://lucacambiaghi.com/static//js/main.js" data-copy=Copy data-copied=Copied></script>
    
  </head>

  <body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 bg-neutral text-neutral-900 sm:px-14 md:px-24 lg:px-32 dark:bg-neutral-800 dark:text-neutral max-w-7xl">
    
    <div id=the-top class="absolute flex self-center">
  <a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 dark:bg-neutral-600 focus:translate-y-0" href=#main-content>
    <span class="font-bold ltr:pr-2 rtl:pl-2 text-primary-600 dark:text-primary-400">&darr;
    </span>Skip to main content
  </a>
</div>

<header class="flex justify-between py-6 font-semibold sm:items-center sm:py-10 text-neutral-900 dark:text-neutral print:hidden">
  <div><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href="/index.html">Luca</a></div>
<nav>
  <ul class="flex list-none sm:flex-row">
    <li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
      <a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href="/posts.html">posts</a>
    </li>
    <span class="px-2 text-primary-500">&#183;</span>
    <li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
      <a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href="/emacsd.html">emacs</a>
    </li>
    <span class="px-2 text-primary-500">&#183;</span>
    <li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
      <a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href="/nix.html">nix</a>
    </li>
  </ul>
</nav>
</header>

    

    <main id="main" class="relative grow">
      
<article class="post">
  <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
    React Native from Clojurescript
  </h1>
  <div class="mt-8 mb-8 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
    <div class="flex flex-row flex-wrap items-center">
      <time> Sep 20, 2020
      </time>
      <span class="px-2 text-primary-500">&#183;</span>
      <span title="tags">(clojurescript reagent react-native)
      </span>
    </div>
  </div>

  <section class="flex flex-col max-w-full mt-0 prose lg:flex-row dark:prose-invert">
    <div class="min-w-0 min-h-0 max-w-prose">
      
<div id="outline-container-org783fd23" class="outline-2">
<h2 id="org783fd23">React Native</h2>
<div class="outline-text-2" id="text-org783fd23">
<p>
I have always been curious about mobile apps development.
In 2018 I tried with a friend to launch a startup and the first thing I tried was to develop a mobile app.
I wanted to write my code only once for Android and iOS and not the same logic twice in Java+Swift.
</p>

<p>
At the time of research the two opponents were <a href="https://dotnet.microsoft.com/apps/xamarin">Xamarin</a> and React Native.
The promise is the same: write the logic once, have the framework manage the native code.
</p>

<p>
After reading some pros and cons I decided to write <code>C#</code> with Xamarin because scared of React and Javascript and the fontend world.
It was an ok experience but the framework was not mature and <code>C#</code> did not excite me.
When I hit my first real problem when implementing authentication, I gave up.
</p>

<p>
Fast forward 2 years and React Native is mature and I am no longer afraid!
<a href="https://github.com/reagent-project/reagent">Reagent</a> made me fall in love React and Clojurescript allows me to skip Javascript.
</p>

<p>
React Native with the support of Facebook has developed rapidly (most active github repo in 2019).
It can leverage the React ecosystem, it has good documentation, its generic components are well designed.
</p>
</div>
</div>

<div id="outline-container-orgc2980df" class="outline-2">
<h2 id="orgc2980df">Figwheel</h2>
<div class="outline-text-2" id="text-orgc2980df">
<p>
Inspired by <a href="https://increasinglyfunctional.com/2020/05/07/clojurescript-react-native-krell-emacs.html">this blog post</a>, my first attemp at React Native from Clojurescript was with Krell.
Krell's philoshopy is to provide a very thin layer over React Native.
Well, I had some hiccups during the setup, I found it still (too) barebones.
</p>

<p>
Few months later I saw another announcement on Slack: <code>figwheel</code> for React Native.
I followed the <a href="https://figwheel.org/docs/react-native.html">Getting Started</a> docs and I quickly had my iOS simulator running alongside <code>figwheel</code> hot-reloading.
</p>

<p>
I had also been hearing very good things about <a href="https://expo.io/">Expo</a>, which should handle for you complicated things like camera, location, notifications.
It was supported out of the box, here is my <code>ios.cljs.edn</code>:
</p>
<div class="org-src-container">
<pre class="src src-clojure">^{<span class="org-clojure-keyword">:react-native</span> <span class="org-clojure-keyword">:expo</span>
  <span class="org-clojure-keyword">:launch-js</span> [<span class="org-string">"yarn"</span> <span class="org-string">"ios"</span>]}
{<span class="org-clojure-keyword">:main</span> app.core}
</pre>
</div>
<p>
When I run <code>cider-jack-in-cljs</code>, CIDER will ask me to run <code>figwheel-main</code>, <code>ios</code> configuration.
This will return a <code>cljs</code> REPL and will run <code>yarn ios</code> in the background.
This is defined in <code>package.json</code> and runs <code>"expo start --ios"</code>.
With the iOS Simulator running I can then run the Expo app and select my iOS build.
</p>
</div>
</div>

<div id="outline-container-orgc8e40fe" class="outline-2">
<h2 id="orgc8e40fe">Reagent</h2>
<div class="outline-text-2" id="text-orgc8e40fe">
<p>
My first steps consisted of learning what a React Native component is.
This is the first example in the Rect Native docs:
</p>
<div class="org-src-container">
<pre class="src src-js"><span class="org-keyword">import</span> { Text, View } from <span class="org-string">'react-native'</span>;

<span class="org-keyword">const</span> <span class="org-variable-name">YourApp</span> = () =&gt; {
  <span class="org-keyword">return</span> (
    &lt;View style={{ flex: 1, justifyContent: <span class="org-string">"center"</span>, alignItems: <span class="org-string">"center"</span> }}&gt;
      &lt;Text&gt;
        Hello World!
      &lt;/Text&gt;
    &lt;/View&gt;
  );
}
</pre>
</div>
<p>
Javascript makes it slightly verbose but the concept is quite simple: our app includes a <code>View</code> component and inside that a <code>Text</code> component.
Since <code>react-native</code> is really just React, we can use <code>reagent</code> to have hiccup-like syntax and smart UI reloading.
</p>

<p>
Looking on github for repos using the <code>cljs</code> + <code>react-native</code> combo I realized that every developer uses <code>js</code> interop in a slightly different way to wrap <code>react-native</code> components.
The <code>reagent-react-native</code> project helps eliminating this "common boilerplate" by providing ready-to-use components.
This is my <code>deps.edn</code>:
</p>
<div class="org-src-container">
<pre class="src src-clojure">{<span class="org-clojure-keyword">:deps</span> {<span class="org-type">org.clojure</span>/clojurescript     {<span class="org-clojure-keyword">:</span><span class="org-type">mvn</span><span class="org-default">/</span><span class="org-clojure-keyword">version</span> <span class="org-string">"1.10.773"</span>}
        <span class="org-type">io.vouch</span>/reagent-react-native {<span class="org-clojure-keyword">:</span><span class="org-type">git</span><span class="org-default">/</span><span class="org-clojure-keyword">url</span> <span class="org-string">"https://github.com/vouch-opensource/reagent-react-native.git"</span>
                                       <span class="org-clojure-keyword">:sha</span>     <span class="org-string">"54bf52788ab051920ed7641f386177374419e847"</span>}
        reagent                       {<span class="org-clojure-keyword">:</span><span class="org-type">mvn</span><span class="org-default">/</span><span class="org-clojure-keyword">version</span> <span class="org-string">"0.10.0"</span>
                                       <span class="org-clojure-keyword">:exclusions</span>  [<span class="org-type">cljsjs</span>/react <span class="org-type">cljsjs</span>/react-dom]}
        <span class="org-type">com.bhauman</span>/figwheel-main     {<span class="org-clojure-keyword">:</span><span class="org-type">mvn</span><span class="org-default">/</span><span class="org-clojure-keyword">version</span> <span class="org-string">"0.2.10-SNAPSHOT"</span>}}}
</pre>
</div>

<p>
And here is the minimal example above, with <code>reagent</code> syntax:
</p>
<div class="org-src-container">
<pre class="src src-clojure">(<span class="org-keyword">ns</span> <span class="org-type">core.app</span>
  (<span class="org-clojure-keyword">:require</span> [react]
            [reagent.react-native <span class="org-clojure-keyword">:as</span> rrn]))

(<span class="org-keyword">defn</span> <span class="org-function-name">hello</span> []
  [<span class="org-type">rrn</span>/view {<span class="org-clojure-keyword">:style</span> {<span class="org-clojure-keyword">:flex</span> 1 <span class="org-clojure-keyword">:align-items</span> <span class="org-string">"center"</span> <span class="org-clojure-keyword">:justify-content</span> <span class="org-string">"center"</span>}}
   [<span class="org-type">rrn</span>/text <span class="org-string">"Hello World!"</span>]])
</pre>
</div>
<p>
It can't get any more simple.
The reagent code is an abstraction for this lower level interop code:
</p>
<div class="org-src-container">
<pre class="src src-clojure">(<span class="org-keyword">def</span> <span class="org-variable-name">&lt;&gt;</span> <span class="org-type">react</span>/createElement)

(&lt;&gt; <span class="org-type">rn</span>/View
      #js {<span class="org-clojure-keyword">:style</span> #js {<span class="org-clojure-keyword">:flex</span>            1
                       <span class="org-clojure-keyword">:align-items</span> <span class="org-string">"center"</span>
                       <span class="org-clojure-keyword">:justifyContent</span>  <span class="org-string">"center"</span>}}
      (&lt;&gt; <span class="org-type">rn</span>/Text (str <span class="org-string">"HELLO WORLD!!"</span>)))
</pre>
</div>

<p>
Following the React Native docs was relatively easy.
I only had troubles when wrapping the <a href="https://reactnative.dev/docs/using-a-listview">FlatList</a> example:
</p>
<div class="org-src-container">
<pre class="src src-js"><span class="org-keyword">const</span> <span class="org-variable-name">FlatListBasics</span> = () =&gt; {
  <span class="org-keyword">return</span> (
    &lt;View style={styles.container}&gt;
      &lt;FlatList
        data={[
          {key: <span class="org-string">'Devin'</span>},
          {key: <span class="org-string">'Dan'</span>},
        ]}
        renderItem={({item}) =&gt; &lt;Text style={styles.item}&gt;{item.key}&lt;/Text&gt;}
      /&gt;
    &lt;/View&gt;
  );
}
</pre>
</div>

<p>
This is how I solved it:
</p>
<div class="org-src-container">
<pre class="src src-clojure">(<span class="org-keyword">defn</span> <span class="org-function-name">flat-list</span> []
  [<span class="org-type">rrn</span>/flat-list
   {<span class="org-clojure-keyword">:data</span>        [{<span class="org-clojure-keyword">:key</span> <span class="org-string">"Devin"</span>}
                  {<span class="org-clojure-keyword">:key</span> <span class="org-string">"Devn"</span>}]
    <span class="org-clojure-keyword">:render-item</span> #(&lt;&gt; <span class="org-type">rn</span>/Text
                      #js {<span class="org-clojure-keyword">:style</span> #js {<span class="org-clojure-keyword">:color</span>     <span class="org-string">"black"</span> <span class="org-clojure-keyword">:textAlign</span> <span class="org-string">"center"</span>}}
                      (.-key (.-item <span class="org-variable-name">%</span>)))}])

</pre>
</div>
<p>
The <code>render-item</code> function is passed a single argument, an object.
We can access the data accessing the <code>.-item</code> key.
</p>
</div>
</div>

<div id="outline-container-org3177256" class="outline-2">
<h2 id="org3177256">Calling clojure</h2>
<div class="outline-text-2" id="text-org3177256">
<p>
You soon come to the realization that 99% of the mobile apps we use can be represented by React Native components, some simple data logic and styling.
What makes <code>cljs</code> attractive for mobile app development is that you can write your logic in <code>clojure</code>.
</p>

<p>
To go beyond the basic tutorial, I decided to develop a quick app to play sudoku.
First I set up the View code to represent the Sudoku grid as a <code>flat-list</code>, as explained above.
Then, to implement the Model code I resorted to Clojure, functional programming and lazy sequences.
</p>

<p>
Instead of having to spin up <code>figwheel</code> + <code>Expo</code> + Simulator, I could simply open a <code>clj</code> REPL.
After writing the code for my sudoku grid in <code>sudoku.clj</code> (note the <code>defmacro</code>):
</p>
<div class="org-src-container">
<pre class="src src-clojure">(<span class="org-keyword">defmacro</span> <span class="org-function-name">sudoku-grid</span> []
  (<span class="org-keyword">-&gt;&gt;</span> (repeatedly nine-rows)
       (filter valid-rows?)
       (filter valid-columns?)
       (filter valid-blocks?)
       first))
</pre>
</div>

<p>
I could simply "require it" in <code>sudoku.cljs</code>:
</p>
<div class="org-src-container">
<pre class="src src-clojure">(<span class="org-keyword">ns</span> <span class="org-type">app.sudoku</span>
  (<span class="org-clojure-keyword">:require-macros</span> [app.sudoku]))
</pre>
</div>
<p>
I could have just written the logic directly in <code>sudoku.cljs</code> but this approach allows to leverage the whole <code>clj</code> ecosystem and permits faster experimentation.
This is the screenshot of the result, it was a lot of fun:
</p>


<div id="orgc95b550" class="figure">
<p><img src="https://raw.githubusercontent.com/lccambiaghi/sudoku-cljsrn/master/assets/screen.png" alt="screen.png" />
</p>
</div>
</div>
</div>

    </div>
  </section>

  <section>
    <div id="hyvor-talk-view"></div>
    <hyvor-talk-comments website-id="793" page-id="react-native-cljs"></hyvor-talk-comments>
  </section>

  <!-- <div class="absolute top-[110vh] ltr:right-0 rtl:left-0 w-12 pointer-events-none bottom-[-5.5rem]"> -->
  <!--   <a href="#the-top" class="w-12 h-12 sticky pointer-events-auto top-[calc(100vh-5rem)] bg-neutral/50 dark:bg-neutral-800/50 backdrop-blur rounded-full text-xl flex items-center justify-center text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">↑</a> -->
  <!-- </div> -->

</article>

    </main>

    <footer class="py-10 print:hidden">
      
      <div class="flex justify-between">
  <div>
    <p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
      Luca Cambiaghi
    </p>
    <p class="text-xs text-neutral-500 dark:text-neutral-400">Theme inspired by
      <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href="https://git.io/hugo-congo" target=_blank rel="noopener noreferrer">Congo</a>
    </p>
  </div>
  <div class="text-sm cursor-pointer text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400 ltr:mr-14 rtl:ml-14">
    <button id=appearance-switcher class="w-12 h-12" type=button title="Switch to dark appearance">
      <span class="inline dark:hidden"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></span><span class="hidden dark:inline"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></span></button></div></div>

      
    </footer>

  </body>
</html>
